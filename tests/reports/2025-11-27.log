bun test v1.3.1 (89fa0f34)

app/utils/fill-in-the-blank-utils.test.ts:
(pass) fill-in-the-blank-utils > isValidBlankId > should accept valid snake_case IDs [2.37ms]
(pass) fill-in-the-blank-utils > isValidBlankId > should accept valid CONSTANT_CASE IDs [0.03ms]
(pass) fill-in-the-blank-utils > isValidBlankId > should reject invalid IDs [0.02ms]
(pass) fill-in-the-blank-utils > parseFillInTheBlank > should parse simple single blank [0.77ms]
(pass) fill-in-the-blank-utils > parseFillInTheBlank > should parse multiple different blanks [0.03ms]
(pass) fill-in-the-blank-utils > parseFillInTheBlank > should handle repeated blank IDs [0.03ms]
(pass) fill-in-the-blank-utils > parseFillInTheBlank > should detect invalid blank IDs [0.02ms]
(pass) fill-in-the-blank-utils > parseFillInTheBlank > should handle mix of valid and invalid IDs [0.03ms]
(pass) fill-in-the-blank-utils > parseFillInTheBlank > should handle prompts with no blanks [0.01ms]
(pass) fill-in-the-blank-utils > parseFillInTheBlank > should handle empty prompt [0.02ms]
(pass) fill-in-the-blank-utils > parseFillInTheBlank > should trim spaces around blank IDs [0.16ms]
(pass) fill-in-the-blank-utils > parseFillInTheBlank > should treat blanks with spaces as same ID after trimming [0.04ms]
(pass) fill-in-the-blank-utils > splitPromptIntoParts > should split prompt with single blank [0.69ms]
(pass) fill-in-the-blank-utils > splitPromptIntoParts > should split prompt with multiple blanks [0.03ms]
(pass) fill-in-the-blank-utils > splitPromptIntoParts > should handle prompt starting with blank [0.01ms]
(pass) fill-in-the-blank-utils > splitPromptIntoParts > should handle prompt ending with blank [0.01ms]
(pass) fill-in-the-blank-utils > splitPromptIntoParts > should handle consecutive blanks [0.01ms]
(pass) fill-in-the-blank-utils > splitPromptIntoParts > should handle prompt with no blanks [0.01ms]
(pass) fill-in-the-blank-utils > splitPromptIntoParts > should handle empty prompt [0.01ms]
(pass) fill-in-the-blank-utils > splitPromptIntoParts > should handle repeated blank IDs
(pass) fill-in-the-blank-utils > splitPromptIntoParts > should trim spaces around blank IDs [0.02ms]
(pass) fill-in-the-blank-utils > splitPromptIntoParts > should treat blanks with spaces as same ID after trimming [0.01ms]

app/components/course-structure-tree.test.ts:
(pass) calculateMoveOperation > should return null for multiple item moves [0.46ms]
(pass) calculateMoveOperation > should handle moving section into another section [0.06ms]
(pass) calculateMoveOperation > should handle moving module above another module [0.03ms]
(pass) calculateMoveOperation > should handle moving to end of children list [0.03ms]

server/internal/activity-module-access.test.ts:
(pass) Activity Module Access Control > should create activity module with owner field [14.92ms]
(pass) Activity Module Access Control > should allow owner to read their activity module [15.69ms]
(pass) Activity Module Access Control > should allow owner to update their activity module [24.55ms]
(pass) Activity Module Access Control > should allow owner to delete their activity module [18.08ms]
(pass) Activity Module Access Control > should not allow non-owner to read activity module [14.86ms]
(pass) Activity Module Access Control > should grant access to another user [36.38ms]
(pass) Activity Module Access Control > should allow granted user to read activity module [29.94ms]
(pass) Activity Module Access Control > should allow granted user to update activity module [28.07ms]
(pass) Activity Module Access Control > should not allow granted user to delete activity module [31.04ms]
(pass) Activity Module Access Control > should revoke access from user [38.47ms]
(pass) Activity Module Access Control > should grant access to previous owner after ownership transfer [51.90ms]
(pass) Activity Module Access Control > should check access for owner [13.80ms]
(pass) Activity Module Access Control > should check access for granted user [22.29ms]
(pass) Activity Module Access Control > should check access for non-granted user [11.70ms]
(pass) Activity Module Access Control > should check access for admin [13.00ms]
(pass) Activity Module Access Control > should allow admin to access any activity module [33.80ms]
(pass) Activity Module Access Control > should prevent duplicate access grants [24.82ms]
(pass) Activity Module Access Control > should prevent owner from being granted access again [14.93ms]
(pass) Activity Module Access Control > should handle ownership transfer removing new owner's grant [43.06ms]
(pass) Activity Module Access Control > should find grants for activity module [32.55ms]
(pass) Activity Module Access Control > should find instructors for activity module [142.66ms]
(pass) Activity Module Access Control > should find instructors from multiple linked courses [321.68ms]
(pass) Activity Module Access Control > should return empty array when no instructors found [16.39ms]
(pass) Activity Module Access Control > should return empty array when no grants found [10.19ms]
(pass) Activity Module Access Control > should find auto granted modules for instructor [304.50ms]
(pass) Activity Module Access Control > should find auto granted modules for TA [307.16ms]
(pass) Activity Module Access Control > should find multiple auto granted modules from multiple courses [339.27ms]
(pass) Activity Module Access Control > should not find auto granted modules for inactive enrollment [192.15ms]
(pass) Activity Module Access Control > should not find auto granted modules for student enrollment [119.73ms]
(pass) Activity Module Access Control > should return empty array when user has no enrollments [16.69ms]
(pass) Activity Module Access Control > should return empty array when no activity modules linked to courses [35.08ms]

server/internal/category-role-management.test.ts:
(pass) Category Role Management Functions > should assign category role to user [21.00ms]
(pass) Category Role Management Functions > should revoke category role from user [26.24ms]
(pass) Category Role Management Functions > should update existing role assignment [25.75ms]
249 | 		// Verify only one assignment exists
250 | 		const assignments = await tryGetCategoryRoleAssignments({
251 | 			payload,
252 | 			categoryId: categoryResult.value.id,
253 | 		});
254 | 		expect(assignments.ok).toBe(true);
                               ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/category-role-management.test.ts:254:26)
(fail) Category Role Management Functions > should prevent duplicate assignments (one role per user per category) [22.11ms]
300 | 		const userRoles = await tryGetUserCategoryRoles({
301 | 			payload,
302 | 			userId: user2.id,
303 | 		});
304 | 
305 | 		expect(userRoles.ok).toBe(true);
                             ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/category-role-management.test.ts:305:24)
(fail) Category Role Management Functions > should get all role assignments for a user [24.52ms]
341 | 		const assignments = await tryGetCategoryRoleAssignments({
342 | 			payload,
343 | 			categoryId: categoryResult.value.id,
344 | 		});
345 | 
346 | 		expect(assignments.ok).toBe(true);
                               ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/category-role-management.test.ts:346:26)
(fail) Category Role Management Functions > should get all role assignments for a category [21.91ms]
373 | 			payload,
374 | 			userId: user1.id,
375 | 			categoryId: categoryResult.value.id,
376 | 		});
377 | 
378 | 		expect(found.ok).toBe(true);
                         ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/category-role-management.test.ts:378:20)
(fail) Category Role Management Functions > should find specific role assignment [13.39ms]
407 | 			categoryId: categoryResult.value.id,
408 | 		});
409 | 
410 | 		expect(checkResult.ok).toBe(true);
411 | 		if (checkResult.ok) {
412 | 			expect(checkResult.value).toBe("category-admin");
                                   ^
error: expect(received).toBe(expected)

Expected: "category-admin"
Received: null

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/category-role-management.test.ts:412:30)
(fail) Category Role Management Functions > should check if user has role on category [13.19ms]
449 | 			payload,
450 | 			userId: user1.id,
451 | 			categoryId: childCat.value.id,
452 | 		});
453 | 
454 | 		expect(effectiveRole.ok).toBe(true);
                                 ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/category-role-management.test.ts:454:28)
(fail) Category Role Management Functions > should get effective role with inheritance from parent category [32.24ms]
514 | 			payload,
515 | 			userId: user1.id,
516 | 			categoryId: child.value.id,
517 | 		});
518 | 
519 | 		expect(effectiveRole.ok).toBe(true);
                                 ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/category-role-management.test.ts:519:28)
(fail) Category Role Management Functions > should respect role priority (admin > coordinator > reviewer) [45.40ms]
581 | 		const userCourses = await tryGetUserCoursesFromCategories({
582 | 			payload,
583 | 			userId: user1.id,
584 | 		});
585 | 
586 | 		expect(userCourses.ok).toBe(true);
                               ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/category-role-management.test.ts:586:26)
(fail) Category Role Management Functions > should get all courses user can access via category roles [67.61ms]
629 | 			courseId: course.value.id,
630 | 		});
631 | 
632 | 		expect(access.ok).toBe(true);
633 | 		if (access.ok) {
634 | 			expect(access.value).toBe("category-admin");
                              ^
error: expect(received).toBe(expected)

Expected: "category-admin"
Received: null

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/category-role-management.test.ts:634:25)
(fail) Category Role Management Functions > should check course access via direct category [35.07ms]
686 | 			courseId: course.value.id,
687 | 		});
688 | 
689 | 		expect(access.ok).toBe(true);
690 | 		if (access.ok) {
691 | 			expect(access.value).toBe("category-coordinator");
                              ^
error: expect(received).toBe(expected)

Expected: "category-coordinator"
Received: null

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/category-role-management.test.ts:691:25)
(fail) Category Role Management Functions > should check course access via ancestor category [43.82ms]

server/internal/assignment-submission-management.test.ts:
(pass) Assignment Submission Management - Full Workflow > should create assignment submission (student workflow) [36.79ms]
(pass) Assignment Submission Management - Full Workflow > should update assignment submission (student editing draft) [64.74ms]
(pass) Assignment Submission Management - Full Workflow > should submit assignment (student submits for grading) [63.64ms]
(pass) Assignment Submission Management - Full Workflow > should grade assignment submission (teacher grades student work) [111.93ms]
(pass) Assignment Submission Management - Full Workflow > should get assignment submission by ID [42.49ms]
(pass) Assignment Submission Management - Full Workflow > should list assignment submissions with filtering [35.60ms]
(pass) Assignment Submission Management - Full Workflow > should handle late submissions [30.07ms]
(pass) Assignment Submission Management - Full Workflow > should prevent duplicate submissions for same attempt [32.06ms]
(pass) Assignment Submission Management - Full Workflow > should validate grade limits [49.80ms]
(pass) Assignment Submission Management - Full Workflow > should only allow grading of submitted assignments [26.79ms]
(pass) Assignment Submission Management - Full Workflow > should delete assignment submission [39.82ms]
(pass) Assignment Submission Management - Full Workflow > should handle pagination in listing [131.00ms]
(pass) Assignment Submission Management - Full Workflow > should fail with invalid arguments [0.20ms]
(pass) Assignment Submission Management - Full Workflow > should fail to get non-existent submission [1.11ms]
(pass) Assignment Submission Management - Full Workflow > should fail to update non-existent submission [1.22ms]
(pass) Assignment Submission Management - Full Workflow > should fail to delete non-existent submission [1.29ms]

server/internal/quiz-submission-management-prevent-duplicate-attempts.test.ts:
145 | 			],
146 | 		};
147 | 
148 | 		const activityModuleResult = await tryCreateQuizModule(activityModuleArgs);
149 | 		if (!activityModuleResult.ok) {
150 | 			throw new Error("Test Error: Failed to create test activity module");
                   ^
error: Test Error: Failed to create test activity module
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/quiz-submission-management-prevent-duplicate-attempts.test.ts:150:14)
(fail) Quiz Attempt Management - Prevent Duplicate Attempts > (unnamed) [1971.22ms]

server/internal/auth.test.ts:
(pass) Authentication Functions > First User Registration and Authentication Flow > should check that no users exist initially [6.53ms]
(pass) Authentication Functions > First User Registration and Authentication Flow > should create and auto-login first user [86.56ms]
(pass) Authentication Functions > First User Registration and Authentication Flow > should verify first user check returns false after user creation [1.77ms]
(pass) Authentication Functions > Manual Login Flow > should login with correct credentials [41.20ms]
(pass) Authentication Functions > Manual Login Flow > should fail login with incorrect credentials [35.80ms]
(pass) Authentication Functions > Manual Login Flow > should fail login with non-existent user [1.36ms]
(pass) Authentication Functions > Authentication and Profile Access > should login and get authentication token [41.24ms]
(pass) Authentication Functions > Authentication and Profile Access > should authenticate user with token and get profile [1.63ms]
(pass) Authentication Functions > Authentication and Profile Access > should get user profile by ID when authenticated [2.23ms]
(pass) Authentication Functions > Authentication and Profile Access > should fail authentication with invalid token [0.34ms]
(pass) Authentication Functions > Authentication and Profile Access > should fail authentication with no token [0.08ms]
(pass) Authentication Functions > Cookie-based Authentication Simulation > should simulate cookie-based authentication flow [42.02ms]
(pass) Authentication Functions > Cookie-based Authentication Simulation > should simulate logout by invalidating token access [0.20ms]
(pass) Authentication Functions > Multiple User Authentication > should create a second user and test separate authentication [76.61ms]

server/internal/search-management.test.ts:
(pass) parseQuery > should parse query
(pass) parseQuery > should parse query with in [0.75ms]
(pass) parseQuery > should parse query with multiple in [0.07ms]
(pass) Search Management Functions > tryGlobalSearch > should return courses and users [6.19ms]
(pass) Search Management Functions > tryGlobalSearch > should users by name [9.48ms]
(pass) Search Management Functions > tryGlobalSearch > should search users by in [5.83ms]
(pass) Search Management Functions > tryGlobalSearch > should search courses by in [2.59ms]
(pass) Search Management Functions > tryGlobalSearch > should search courses by name [3.56ms]
(pass) Search Management Functions > Search Collection Sync on Deletion > should remove course from search when course is deleted [1087.34ms]
(pass) Search Management Functions > Search Collection Sync on Deletion > should remove user from search when user is deleted [1149.41ms]
(pass) Search Management Functions > Search Collection Sync on Deletion > should update search when course is updated [1620.87ms]

server/internal/gradebook-category-management.test.ts:
(pass) Gradebook Category Management > should create a gradebook category [8.14ms]
(pass) Gradebook Category Management > should not create category with invalid sort order [0.14ms]
(pass) Gradebook Category Management > should create a subcategory [15.24ms]
(pass) Gradebook Category Management > should persist nested category after creation [145.86ms]
(pass) Gradebook Category Management > should find gradebook category by ID [6.82ms]
(pass) Gradebook Category Management > should update gradebook category [32.24ms]
(pass) Gradebook Category Management > should get gradebook categories hierarchy [17.33ms]
(pass) Gradebook Category Management > should get next sort order [6.46ms]
(pass) Gradebook Category Management > should reorder categories [12.02ms]
(pass) Gradebook Category Management > should delete gradebook category [32.25ms]
(pass) Gradebook Category Management > should not find deleted category [1.61ms]

server/internal/file-management.test.ts:
(pass) File Management Functions > should create a file with valid media [7.12ms]
(pass) File Management Functions > should create a file with empty media array [5.74ms]
(pass) File Management Functions > should create a file without media [10.52ms]
(pass) File Management Functions > should fail to create a file without userId [0.62ms]
(pass) File Management Functions > should get a file by ID [21.51ms]
(pass) File Management Functions > should fail to get a non-existent file [1.42ms]
(pass) File Management Functions > should update a file media [22.45ms]
(pass) File Management Functions > should update a file to have no media [15.28ms]
(pass) File Management Functions > should fail to update a non-existent file [2.44ms]
(pass) File Management Functions > should delete a file [15.77ms]
(pass) File Management Functions > should fail to delete a non-existent file [0.69ms]

server/internal/media-management.test.ts:
(pass) Media Management > should fail to create media with invalid data [0.21ms]
(pass) Media Management > Should create image media [19.55ms]
(pass) Media Management > should get all media in database [2.45ms]
(pass) Media Management > should get media by filename [19.68ms]
(pass) Media Management > should fail to get media with non-existent filename [0.58ms]
(pass) Media Management > should fail to get media with empty filename [0.12ms]
(pass) Media Management > should get media buffer from filename [27.18ms]
(pass) Media Management > should fail to get buffer for non-existent file [3.27ms]
(pass) Media Management > should fail to get buffer with empty filename [0.18ms]
(pass) Media Management > should find media by user [43.85ms]
(pass) Media Management > should find media by user with pagination [2.23ms]
(pass) Media Management > should delete a single media record [61.12ms]
(pass) Media Management > should fail to delete media with usage [48.18ms]
(pass) Media Management > should delete multiple media records (batch delete) [92.24ms]
(pass) Media Management > should fail to delete media with empty array [0.06ms]
(pass) Media Management > should fail to delete non-existent media [0.63ms]
(pass) Media Management > should fail to delete media when some IDs don't exist [18.66ms]
(pass) Media Management > should fail to delete multiple media when one has usage [58.18ms]
(pass) Media Management > should get user media stats [40.25ms]
(pass) Media Management > should get system media stats [1.44ms]
(pass) Media Management > should rename media file [40.48ms]
(pass) Media Management > should fail to rename media with duplicate filename [32.49ms]
(pass) Media Management > should get orphaned media files [30.13ms]
(pass) Media Management > should get orphaned media with pagination [30.87ms]
(pass) Media Management > should delete orphaned media files [19.40ms]
(pass) Media Management > should fail to delete non-orphaned media files [16.33ms]
(pass) Media Management > should fail to delete orphaned media with empty array [0.13ms]
(pass) Media Management > should find all media usages across collections [332.64ms]
(pass) Media Management > should find no usages for media with no references [30.45ms]
(pass) Media Management > should fail to find usages for non-existent media [0.50ms]
(pass) Media Management > should fail to find usages with invalid media ID [0.06ms]

server/internal/course-section-management.test.ts:
(pass) Course Section Management Functions > should create a nested section with valid parent [34.62ms]
(pass) Course Section Management Functions > should create deeply nested sections (3+ levels) [73.34ms]
(pass) Course Section Management Functions > should prevent circular reference when creating section [41.47ms]
(pass) Course Section Management Functions > should prevent circular reference when updating parent [99.43ms]
(pass) Course Section Management Functions > should update section properties (title, description, order) [55.89ms]
(pass) Course Section Management Functions > should delete section without children or modules [68.06ms]
(pass) Course Section Management Functions > should prevent delete section with child sections [86.08ms]
(pass) Course Section Management Functions > should prevent delete section with activity modules [120.88ms]
(pass) Course Section Management Functions > should find sections by course [14.33ms]
(pass) Course Section Management Functions > should find root sections [16.59ms]
(pass) Course Section Management Functions > should find child sections [136.10ms]
(pass) Course Section Management Functions > should get section tree structure [16.35ms]
(pass) Course Section Management Functions > should get section ancestors [154.96ms]
(pass) Course Section Management Functions > should calculate section depth [140.34ms]
(pass) Course Section Management Functions > should reorder single section [242.43ms]
(pass) Course Section Management Functions > should reorder multiple sections in batch [200.70ms]
(pass) Course Section Management Functions > should nest section under parent [156.19ms]
(pass) Course Section Management Functions > should unnest section to root [285.66ms]
(pass) Course Section Management Functions > should move section between parents [414.82ms]
(pass) Course Section Management Functions > should add activity module to section [228.74ms]
(pass) Course Section Management Functions > should remove activity module from section [236.16ms]
(pass) Course Section Management Functions > should reorder activity modules within section [306.99ms]
(pass) Course Section Management Functions > should move activity module between sections [554.72ms]
(pass) Course Section Management Functions > should count modules in section [254.53ms]
(pass) Course Section Management Functions > should validate no circular reference [214.05ms]
(pass) Course Section Management Functions > should get course structure with nested sections and activity modules [867.43ms]
(pass) Course Section Management Functions > should get course structure with empty course [26.88ms]
(pass) Course Section Management Functions > should get course structure with sections but no activity modules [512.38ms]
(pass) Course Section Management Functions > should handle course structure with deeply nested sections [509.68ms]
(pass) Course Section Management Functions > should prevent delete last section in course [39.77ms]
(pass) Course Section Management Functions > should allow delete section when course has multiple sections [235.14ms]

(pass) Course Section Management Functions > should generate tree representation from course structure [276.71ms]


(pass) Course Section Management Functions > should create complex course structure with exact tree specification [2845.82ms]











(pass) Course Section Management Functions > tryGeneralMove - comprehensive move scenarios [1757.30ms]
(pass) Course Section Management Functions > should move activity module above another activity module [1428.16ms]



(pass) Course Section Management Functions > should respect custom module names from course module settings [699.68ms]

server/internal/page-management.test.ts:
(pass) Page Management Functions > should create a page with valid content [5.88ms]
(pass) Page Management Functions > should create a page with empty content [4.19ms]
(pass) Page Management Functions > should fail to create a page without userId [0.09ms]
(pass) Page Management Functions > should get a page by ID [6.17ms]
(pass) Page Management Functions > should fail to get a non-existent page [1.00ms]
(pass) Page Management Functions > should update a page content [12.70ms]
(pass) Page Management Functions > should create a page with media references in HTML [5.43ms]
(pass) Page Management Functions > should update page media array when content changes [10.89ms]
(pass) Page Management Functions > should fail to update a non-existent page [0.97ms]
(pass) Page Management Functions > should delete a page [16.24ms]
(pass) Page Management Functions > should fail to delete a non-existent page [0.78ms]

server/internal/whiteboard-management.test.ts:
(pass) Whiteboard Management Functions > should create a whiteboard with valid JSON content [4.92ms]
(pass) Whiteboard Management Functions > should create a whiteboard with empty content [3.97ms]
(pass) Whiteboard Management Functions > should fail to create a whiteboard without userId [0.12ms]
(pass) Whiteboard Management Functions > should get a whiteboard by ID [4.25ms]
(pass) Whiteboard Management Functions > should fail to get a non-existent whiteboard [0.43ms]
(pass) Whiteboard Management Functions > should update a whiteboard content [11.01ms]
(pass) Whiteboard Management Functions > should fail to update a non-existent whiteboard [0.45ms]
(pass) Whiteboard Management Functions > should delete a whiteboard [10.47ms]
(pass) Whiteboard Management Functions > should fail to delete a non-existent whiteboard [0.42ms]

server/internal/course-category-management.test.ts:
(pass) Course Category Management Functions > should create a root category [3.44ms]
(pass) Course Category Management Functions > should create a nested category with valid parent [14.44ms]
(pass) Course Category Management Functions > should prevent circular reference when creating category [6.39ms]
(pass) Course Category Management Functions > should prevent circular reference when updating parent [15.28ms]
(pass) Course Category Management Functions > should enforce max category depth when configured [22.89ms]
(pass) Course Category Management Functions > should update category name [6.76ms]
(pass) Course Category Management Functions > should change category parent [12.78ms]
(pass) Course Category Management Functions > should delete empty category [10.52ms]
(pass) Course Category Management Functions > should fail to delete category with subcategories [6.42ms]
(pass) Course Category Management Functions > should fail to delete category with courses [19.73ms]
(pass) Course Category Management Functions > should find category by ID [3.82ms]
(pass) Course Category Management Functions > should get category tree structure [63.71ms]
(pass) Course Category Management Functions > should get category ancestors [16.44ms]
(pass) Course Category Management Functions > should calculate category depth correctly [18.53ms]
(pass) Course Category Management Functions > should count total nested courses correctly [46.73ms]
(pass) Course Category Management Functions > should find root categories [8.25ms]
(pass) Course Category Management Functions > should find subcategories [14.69ms]
(pass) Course Category Management Functions > should assign course to category [15.87ms]
(pass) Course Category Management Functions > should move course between categories [37.27ms]

server/internal/course-management.test.ts:
(pass) Course Management Functions > tryCreateCourse > should create a new course successfully [9.16ms]
(pass) Course Management Functions > tryCreateCourse > should create course with default values [7.33ms]
(pass) Course Management Functions > tryCreateCourse > should fail when instructor does not exist [1.80ms]
(pass) Course Management Functions > tryUpdateCourse > should update course successfully [24.69ms]
(pass) Course Management Functions > tryUpdateCourse > should create a course with media references in description [10.90ms]
(pass) Course Management Functions > tryUpdateCourse > should update course media array when description changes [26.14ms]
(pass) Course Management Functions > tryUpdateCourse > should update course category [34.67ms]
(pass) Course Management Functions > tryFindCourseById > should find existing course by ID [13.84ms]
(pass) Course Management Functions > tryFindCourseById > should fail when finding non-existent course by ID [1.96ms]
(pass) Course Management Functions > trySearchCourses > should search courses with no filters [9.49ms]
(pass) Course Management Functions > trySearchCourses > should search courses by title [29.31ms]
(pass) Course Management Functions > tryDeleteCourse > should delete course successfully [39.40ms]
(pass) Course Management Functions > tryFindCoursesByInstructor > should find courses by instructor [0.07ms]
(pass) Course Management Functions > tryFindPublishedCourses > should find only published courses [0.02ms]
(pass) Course Management Functions > Integration Tests > should handle complete course lifecycle [69.69ms]
(pass) Course Management Functions > tryGetUserAccessibleCourses > should return only owned courses for admin user [13.15ms]
(pass) Course Management Functions > tryGetUserAccessibleCourses > should return only owned courses for content manager user [12.16ms]
(pass) Course Management Functions > tryGetUserAccessibleCourses > should return courses from enrollments and ownership for regular user [20.94ms]
(pass) Course Management Functions > tryGetUserAccessibleCourses > should not return courses from category roles for regular user [12.55ms]
(pass) Course Management Functions > tryGetUserAccessibleCourses > should not return courses user has no access to [12.20ms]
(pass) Course Management Functions > tryGetUserAccessibleCourses > should prioritize enrollment over ownership when user has both [37.83ms]
(pass) Course Management Functions > tryGetUserAccessibleCourses > should handle completed enrollment status [31.15ms]
(pass) Course Management Functions > tryGetUserAccessibleCourses > should handle user with no course access [47.66ms]
(pass) Course Management Functions > tryGetUserAccessibleCourses - Access Control Tests > should only return courses user owns or is enrolled in with overrideAccess false [18.23ms]
(pass) Course Management Functions > tryGetUserAccessibleCourses - Access Control Tests > should work with overrideAccess true even for different user [10.41ms]
(pass) Course Management Functions > tryGetUserAccessibleCourses - Access Control Tests > should handle user with no courses gracefully [45.74ms]
(pass) Course Management Functions > tryGetUserAccessibleCourses - Access Control Tests > should prioritize enrollment over ownership when user has both [73.94ms]

server/internal/user-management.test.ts:
(pass) User Management Functions > tryCreateUser > should create a new user successfully with overrideAccess [48.19ms]
(pass) User Management Functions > tryCreateUser > should fail when creating user with duplicate email [44.12ms]
(pass) User Management Functions > tryCreateUser > should create user with default role as user [40.89ms]
(pass) User Management Functions > tryCreateUser > admin should be able to create users [42.22ms]
(pass) User Management Functions > tryCreateUser > unauthenticated request should fail to create user [0.28ms]
(pass) User Management Functions > tryCreateUser > should create user with explicit theme value [38.61ms]
(pass) User Management Functions > tryCreateUser > should create user with default theme as light when not specified [40.23ms]
(pass) User Management Functions > tryUpdateUser > should update user successfully with overrideAccess [55.10ms]
(pass) User Management Functions > tryUpdateUser > should fail when updating non-existent user [1.69ms]
(pass) User Management Functions > tryUpdateUser > unauthenticated request should fail to update user [1.86ms]
(pass) User Management Functions > tryUpdateUser > should update user theme from light to dark [56.58ms]
(pass) User Management Functions > tryFindUserByEmail > should find existing user by email with overrideAccess [44.42ms]
(pass) User Management Functions > tryFindUserByEmail > should return null for non-existent email [1.72ms]
(pass) User Management Functions > tryFindUserByEmail > unauthenticated request should fail to find user [0.18ms]
(pass) User Management Functions > tryFindUserById > should find existing user by ID with overrideAccess [46.05ms]
(pass) User Management Functions > tryFindUserById > should fail when finding non-existent user by ID [1.62ms]
(pass) User Management Functions > tryFindUserById > unauthenticated request should fail to find user [0.13ms]
(pass) User Management Functions > tryDeleteUser > should delete user successfully with overrideAccess [78.77ms]
(pass) User Management Functions > tryDeleteUser > admin should be able to delete any user [61.09ms]
(pass) User Management Functions > tryDeleteUser > unauthenticated request should fail to delete user [2.56ms]
(pass) User Management Functions > tryFindAllUsers > should find all users with overrideAccess [127.03ms]
(pass) User Management Functions > tryFindAllUsers > should support pagination [1.82ms]
(pass) User Management Functions > tryFindAllUsers > should support sorting [3.10ms]
(pass) User Management Functions > tryFindAllUsers > admin should be able to find all users [4.54ms]
(pass) User Management Functions > tryFindAllUsers > unauthenticated request should fail to find all users [0.22ms]
(pass) User Management Functions > tryFindAllUsers > should comprehensively test search functionality with text and role filters [246.61ms]
(pass) User Management Functions > Integration Tests > should handle complete user lifecycle with overrideAccess [100.37ms]
(pass) User Management Functions > User Impersonation > should not allow admin to impersonate another admin [59.49ms]
(pass) User Management Functions > User Impersonation > should return null for invalid user ID [0.20ms]
(pass) User Management Functions > User Impersonation > should return null for non-existent user ID [1.25ms]

server/internal/quiz-submission-management-full-workflow.test.ts:
(pass) Quiz Management - Full Workflow > should create quiz (teacher workflow) [11.30ms]
435 | 			overrideAccess: true,
436 | 		};
437 | 
438 | 		const result = await tryCreateQuizSubmission(args);
439 | 
440 | 		expect(result.ok).toBe(true);
                          ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/quiz-submission-management-full-workflow.test.ts:440:21)
(fail) Quiz Management - Full Workflow > should create quiz submission (student workflow) [13.97ms]
479 | 			],
480 | 			overrideAccess: true,
481 | 		};
482 | 
483 | 		const createResult = await tryCreateQuizSubmission(createArgs);
484 | 		expect(createResult.ok).toBe(true);
                                ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/quiz-submission-management-full-workflow.test.ts:484:27)
(fail) Quiz Management - Full Workflow > should update quiz submission (student editing answers) [4.16ms]
563 | 			],
564 | 			overrideAccess: true,
565 | 		};
566 | 
567 | 		const createResult = await tryCreateQuizSubmission(createArgs);
568 | 		expect(createResult.ok).toBe(true);
                                ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/quiz-submission-management-full-workflow.test.ts:568:27)
(fail) Quiz Management - Full Workflow > should submit quiz (student submits for grading) [4.48ms]
639 | 			req: mockRequest,
640 | 			quizId,
641 | 			answers,
642 | 		});
643 | 
644 | 		expect(result.ok).toBe(true);
                          ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/quiz-submission-management-full-workflow.test.ts:644:21)
(fail) Quiz Management - Full Workflow > should calculate quiz grade automatically [4.37ms]
(pass) Quiz Management - Full Workflow > should get quiz by ID [4.31ms]
730 | 			],
731 | 			overrideAccess: true,
732 | 		};
733 | 
734 | 		const createResult = await tryCreateQuizSubmission(createArgs);
735 | 		expect(createResult.ok).toBe(true);
                                ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/quiz-submission-management-full-workflow.test.ts:735:27)
(fail) Quiz Management - Full Workflow > should get quiz submission by ID [13.07ms]
767 | 
768 | 		expect(listResult.ok).toBe(true);
769 | 		if (!listResult.ok) return;
770 | 
771 | 		const submissions = listResult.value;
772 | 		expect(submissions.docs.length).toBeGreaterThan(0);
                                        ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/quiz-submission-management-full-workflow.test.ts:772:35)
(fail) Quiz Management - Full Workflow > should list quiz submissions with filtering [2.50ms]
832 | 			overrideAccess: true,
833 | 		};
834 | 
835 | 		const result = await tryCreateQuizSubmission(lateArgs);
836 | 
837 | 		expect(result.ok).toBe(true);
                          ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/quiz-submission-management-full-workflow.test.ts:837:21)
(fail) Quiz Management - Full Workflow > should handle late submissions [13.53ms]
867 | 			overrideAccess: true,
868 | 		};
869 | 
870 | 		// Create first submission
871 | 		const firstResult = await tryCreateQuizSubmission(args);
872 | 		expect(firstResult.ok).toBe(true);
                               ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/quiz-submission-management-full-workflow.test.ts:872:26)
(fail) Quiz Management - Full Workflow > should prevent duplicate submissions for same attempt [18.36ms]
899 | 			],
900 | 			overrideAccess: true,
901 | 		};
902 | 
903 | 		const createResult = await tryCreateQuizSubmission(createArgs);
904 | 		expect(createResult.ok).toBe(true);
                                ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/quiz-submission-management-full-workflow.test.ts:904:27)
(fail) Quiz Management - Full Workflow > should only allow grading of completed quizzes [15.44ms]
942 | 			],
943 | 			overrideAccess: true,
944 | 		};
945 | 
946 | 		const createResult = await tryCreateQuizSubmission(createArgs);
947 | 		expect(createResult.ok).toBe(true);
                                ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/quiz-submission-management-full-workflow.test.ts:947:27)
(fail) Quiz Management - Full Workflow > should delete quiz submission [15.44ms]
986 | 				],
987 | 				overrideAccess: true,
988 | 			};
989 | 
990 | 			const createResult = await tryCreateQuizSubmission(createArgs);
991 | 			expect(createResult.ok).toBe(true);
                                 ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/quiz-submission-management-full-workflow.test.ts:991:28)
(fail) Quiz Management - Full Workflow > should handle pagination in listing [17.84ms]
(pass) Quiz Management - Full Workflow > should fail with invalid arguments [0.20ms]
(pass) Quiz Management - Full Workflow > should fail to get non-existent submission [2.04ms]
(pass) Quiz Management - Full Workflow > should fail to update non-existent submission [3.32ms]
(pass) Quiz Management - Full Workflow > should fail to delete non-existent submission [1.78ms]
(pass) Quiz Management - Full Workflow > should store and retrieve rawQuizConfig [13.83ms]
1276 | 		};
1277 | 
1278 | 		const quickActivityModuleResult = await tryCreateQuizModule(
1279 | 			quickActivityModuleArgs,
1280 | 		);
1281 | 		expect(quickActivityModuleResult.ok).toBe(true);
                                              ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/quiz-submission-management-full-workflow.test.ts:1281:40)
(fail) Quiz Management - Full Workflow > should reject submission after time limit exceeded [10.35ms]
1448 | 		};
1449 | 
1450 | 		const autoSubmitActivityModuleResult = await tryCreateQuizModule(
1451 | 			autoSubmitActivityModuleArgs,
1452 | 		);
1453 | 		expect(autoSubmitActivityModuleResult.ok).toBe(true);
                                                   ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/quiz-submission-management-full-workflow.test.ts:1453:45)
(fail) Quiz Management - Full Workflow > should auto-submit quiz when timer expires [8.96ms]

server/internal/quiz-submission-management-attempt-start-retrieve.test.ts:
147 | 			],
148 | 		};
149 | 
150 | 		const activityModuleResult = await tryCreateQuizModule(activityModuleArgs);
151 | 		if (!activityModuleResult.ok) {
152 | 			throw new Error("Test Error: Failed to create test activity module");
                   ^
error: Test Error: Failed to create test activity module
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/quiz-submission-management-attempt-start-retrieve.test.ts:152:14)
(fail) Quiz Attempt Management - Start and Retrieve > (unnamed) [1965.96ms]

server/internal/email.test.ts:
(pass) Email Management > should fail when recipient email is missing [0.30ms]
(pass) Email Management > should fail when recipient email format is invalid [0.08ms]

server/internal/check-first-user.test.ts:
(fail) First User Check Functions - With overrideAccess > tryCheckFirstUser > should return true when no users exist [5005.94ms]
  ^ this test timed out after 5000ms.
83 | 				overrideAccess: true,
84 | 			};
85 | 
86 | 			const result = await tryCheckFirstUser(args);
87 | 
88 | 			expect(result.ok).toBe(true);
                          ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/check-first-user.test.ts:88:22)
(fail) First User Check Functions - With overrideAccess > tryCheckFirstUser > should return false when users exist [2.79ms]
 99 | 				overrideAccess: true,
100 | 			};
101 | 
102 | 			const result = await tryGetUserCount(args);
103 | 
104 | 			expect(result.ok).toBe(true);
                           ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/check-first-user.test.ts:104:22)
(fail) First User Check Functions - With overrideAccess > tryGetUserCount > should return correct user count [0.58ms]
(fail) First User Check Functions - With overrideAccess > tryGetUserCount > should return 0 when no users exist [5000.37ms]
  ^ this test timed out after 5000ms.
137 | 				overrideAccess: true,
138 | 			};
139 | 
140 | 			const result = await tryValidateFirstUserState(args);
141 | 
142 | 			expect(result.ok).toBe(true);
                           ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/check-first-user.test.ts:142:22)
(fail) First User Check Functions - With overrideAccess > tryValidateFirstUserState > should return valid state with correct structure [5.77ms]
156 | 				overrideAccess: true,
157 | 			};
158 | 
159 | 			const result = await tryValidateFirstUserState(args);
160 | 
161 | 			expect(result.ok).toBe(true);
                           ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/check-first-user.test.ts:161:22)
(fail) First User Check Functions - With overrideAccess > tryValidateFirstUserState > should return isValid=true when database is accessible [1.07ms]
1 | import { buildOrderBy } from './buildOrderBy.js';
2 | import { parseParams } from './parseParams.js';
3 | export const buildQuery = function buildQuery({ adapter, aliasTable, fields, joins = [], locale, parentIsLocalized, selectLocale, sort, tableName, where: incomingWhere }) {
4 |     const selectFields = {
5 |         id: adapter.tables[tableName].id
                               ^
TypeError: undefined is not an object (evaluating 'adapter.tables[tableName].id')
      at buildQuery (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js:5:28)
      at find (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/find/findMany.js:20:53)
      at find (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/find/findMany.js:8:44)
      at find (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/find.js:3:40)
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/payload/dist/collections/operations/delete.js:77:43)
(fail) First User Check Functions - With overrideAccess > tryValidateFirstUserState > should return userCount matching actual database state [10.95ms]
226 | 			};
227 | 
228 | 			const needsFirstUserResult = await tryCheckFirstUser(checkArgs);
229 | 			const userCountResult = await tryGetUserCount(countArgs);
230 | 
231 | 			expect(needsFirstUserResult.ok).toBe(true);
                                         ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/check-first-user.test.ts:231:36)
(fail) First User Check Functions - With overrideAccess > Integration Tests > tryCheckFirstUser and tryGetUserCount should be consistent [0.82ms]
258 | 
259 | 			const validationState = await tryValidateFirstUserState(validateArgs);
260 | 			const needsFirstUser = await tryCheckFirstUser(checkArgs);
261 | 			const userCount = await tryGetUserCount(countArgs);
262 | 
263 | 			expect(validationState.ok).toBe(true);
                                    ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/check-first-user.test.ts:263:31)
(fail) First User Check Functions - With overrideAccess > Integration Tests > tryValidateFirstUserState should match individual function results [0.53ms]

1 | import { buildOrderBy } from './buildOrderBy.js';
2 | import { parseParams } from './parseParams.js';
3 | export const buildQuery = function buildQuery({ adapter, aliasTable, fields, joins = [], locale, parentIsLocalized, selectLocale, sort, tableName, where: incomingWhere }) {
4 |     const selectFields = {
5 |         id: adapter.tables[tableName].id
                               ^
TypeError: undefined is not an object (evaluating 'adapter.tables[tableName].id')
      at buildQuery (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js:5:28)
      at find (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/find/findMany.js:20:53)
      at find (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/find/findMany.js:8:44)
      at find (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/find.js:3:40)
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/payload/dist/collections/operations/delete.js:77:43)


1 | import { buildOrderBy } from './buildOrderBy.js';
2 | import { parseParams } from './parseParams.js';
3 | export const buildQuery = function buildQuery({ adapter, aliasTable, fields, joins = [], locale, parentIsLocalized, selectLocale, sort, tableName, where: incomingWhere }) {
4 |     const selectFields = {
5 |         id: adapter.tables[tableName].id
                               ^
TypeError: undefined is not an object (evaluating 'adapter.tables[tableName].id')
      at buildQuery (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js:5:28)
      at find (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/find/findMany.js:20:53)
      at find (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/find/findMany.js:8:44)
      at find (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/find.js:3:40)
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/payload/dist/collections/operations/delete.js:77:43)

315 | 			overrideAccess: true,
316 | 		};
317 | 
318 | 		const adminResult = await tryCreateUser(adminArgs);
319 | 		if (!adminResult.ok) {
320 | 			throw new Error("Failed to create admin user");
                   ^
error: Failed to create admin user
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/check-first-user.test.ts:320:14)
(fail) First User Check Functions - With Access Control > (unnamed) [1830.58ms]

server/internal/utils/parse-media-from-html.test.ts:
(pass) Parse Media From HTML > should parse media IDs from HTML
(pass) Parse Media From HTML > should parse media filenames from HTML [0.59ms]
(pass) Parse Media From HTML > should handle mixed ID and filename formats [0.08ms]
(pass) Parse Media From HTML > should return unique media IDs and filenames (no duplicates) [0.42ms]
(pass) Parse Media From HTML > should return empty arrays for HTML without media references [0.17ms]
(pass) Parse Media From HTML > should return empty arrays for empty HTML [0.10ms]
(pass) Parse Media From HTML > should return empty arrays for whitespace-only HTML [0.08ms]
(pass) Parse Media From HTML > should ignore images without src attributes [0.24ms]
(pass) Parse Media From HTML > should ignore images with non-media URLs [0.08ms]
(pass) Parse Media From HTML > should handle URLs with query parameters [0.08ms]
(pass) Parse Media From HTML > should handle URLs with hash fragments [0.06ms]
(pass) Parse Media From HTML > should parse both IDs and filenames regardless of existence [0.08ms]
(pass) Parse Media From HTML > should handle complex HTML with nested elements [0.04ms]

server/internal/utils/gradebook-weight-calculations.test.ts:
(pass) Gradebook Weight Calculations > calculateAdjustedWeights > should calculate adjusted weights for items with specified weights [0.08ms]
(pass) Gradebook Weight Calculations > calculateAdjustedWeights > should calculate adjusted weights for items without weights [0.09ms]
(pass) Gradebook Weight Calculations > calculateAdjustedWeights > should calculate adjusted weights for mixed items [0.10ms]
(pass) Gradebook Weight Calculations > calculateAdjustedWeights > should calculate adjusted weights for nested categories [0.07ms]
(pass) Gradebook Weight Calculations > calculateAdjustedWeights > should exclude extra credit items from weight distribution [0.08ms]
(pass) Gradebook Weight Calculations > calculateAdjustedWeights > should distribute remaining weight only among non-extra-credit items [0.04ms]
(pass) Gradebook Weight Calculations > calculateAdjustedWeights > should mark empty auto-weighted category as auto-weighted-0 [0.03ms]
(pass) Gradebook Weight Calculations > calculateAdjustedWeights > should mark category with only extra credit items as auto-weighted-0 [0.03ms]
(pass) Gradebook Weight Calculations > calculateAdjustedWeights > should exclude auto-weighted-0 categories from weight distribution [0.06ms]
(pass) Gradebook Weight Calculations > calculateAdjustedWeights > should mark category with all auto-weighted-0 subcategories as auto-weighted-0 [0.04ms]
(pass) Gradebook Weight Calculations > calculateAdjustedWeights > should not mark category with non-extra-credit items as auto-weighted-0 [0.04ms]
(pass) Gradebook Weight Calculations > calculateOverallWeights > should calculate overall weights for root-level items [0.04ms]
(pass) Gradebook Weight Calculations > calculateOverallWeights > should calculate overall weights for items in categories [0.13ms]
(pass) Gradebook Weight Calculations > calculateOverallWeights > should calculate overall weights for nested categories [0.20ms]
(pass) Gradebook Weight Calculations > calculateOverallWeights > should set overall weight to null for items without adjusted weight [0.05ms]
(pass) Gradebook Weight Calculations > calculateOverallWeights > should not calculate overall weight for categories [0.03ms]
(pass) Gradebook Weight Calculations > calculateOverallWeights > should calculate total overall weight correctly without extra credit [0.06ms]
(pass) Gradebook Weight Calculations > calculateOverallWeights > should calculate total overall weight correctly with extra credit [0.06ms]
(pass) Gradebook Weight Calculations > calculateOverallWeights > should reproduce 101.05% scenario and verify calculation [0.06ms]
(pass) Gradebook Weight Calculations > calculateOverallWeights > should reproduce exact 101.05% scenario with extra credit [0.07ms]
(pass) Gradebook Weight Calculations > calculateOverallWeights > should reproduce 113.8% scenario with extra credit items in categories [0.13ms]
(pass) Gradebook Weight Calculations > calculateOverallWeights > should calculate extra credit total including extra credit categories [0.13ms]

server/internal/utils/validate-gradebook-weights.test.ts:
(pass) validateGradebookWeights > should pass when total weight equals exactly 100% with no auto-weighted items [0.02ms]
(pass) validateGradebookWeights > should fail when total weight does not equal 100% with no auto-weighted items [0.61ms]
(pass) validateGradebookWeights > should pass when specified weights <= 100% with auto-weighted items [0.05ms]
(pass) validateGradebookWeights > should pass when specified weights equal 100% with auto-weighted items [0.04ms]
(pass) validateGradebookWeights > should fail when specified weights exceed 100% with auto-weighted items [0.05ms]
(pass) validateGradebookWeights > should filter out extra credit items from validation [0.06ms]
(pass) validateGradebookWeights > should skip validation when only extra credit items exist [0.03ms]
(pass) validateGradebookWeights > should validate nested categories recursively [0.08ms]
(pass) validateGradebookWeights > should validate multiple nested categories [0.04ms]
(pass) validateGradebookWeights > should handle deeply nested categories [0.05ms]
(pass) validateGradebookWeights > should handle empty items array [0.02ms]
(pass) validateGradebookWeights > should handle items with zero weight [0.02ms]
(pass) validateGradebookWeights > should use custom error message prefix [0.01ms]

server/internal/utils/build-gradebook-structure.test.ts:
(pass) Build Gradebook Structure > should not duplicate root-level items when processing root categories [0.09ms]
(pass) Build Gradebook Structure > should include items when processing a specific category [0.05ms]
(pass) Build Gradebook Structure > should handle nested categories correctly [0.02ms]
(pass) Build Gradebook Structure > should include extra_credit field when building structure [0.06ms]

server/internal/utils/validate-script-tag.test.ts:
(pass) Validate Script Tag > should validate valid script tag with src only [2.07ms]
(pass) Validate Script Tag > should validate script tag with defer attribute [0.15ms]
(pass) Validate Script Tag > should validate script tag with async attribute [0.09ms]
(pass) Validate Script Tag > should validate script tag with both defer and async [0.06ms]
(pass) Validate Script Tag > should validate Umami script tag with data-website-id [0.07ms]
(pass) Validate Script Tag > should validate Plausible script tag with data-domain [0.09ms]
(pass) Validate Script Tag > should validate Fathom script tag with data-site [0.07ms]
(pass) Validate Script Tag > should validate Google Analytics script tag [0.07ms]
(pass) Validate Script Tag > should validate script tag with multiple data attributes [0.05ms]
(pass) Validate Script Tag > should reject script tag without src attribute [0.18ms]
(pass) Validate Script Tag > should reject inline script content [0.13ms]
(pass) Validate Script Tag > should reject script tag with onerror attribute [0.07ms]
(pass) Validate Script Tag > should reject script tag with onload attribute [0.10ms]
(pass) Validate Script Tag > should reject script tag with onclick attribute [0.04ms]
(pass) Validate Script Tag > should reject script tag with integrity attribute [0.04ms]
(pass) Validate Script Tag > should reject script tag with crossorigin attribute [0.05ms]
(pass) Validate Script Tag > should reject script tag with non-HTTP/HTTPS URL [0.05ms]
(pass) Validate Script Tag > should reject script tag with file:// URL [0.04ms]
(pass) Validate Script Tag > should reject invalid URL format [0.43ms]
(pass) Validate Script Tag > should reject script tag with unknown attribute [0.16ms]
(pass) Validate Script Tag > should reject empty script tag [0.04ms]
(pass) Validate Script Tag > should reject whitespace-only script tag [0.04ms]
(pass) Validate Script Tag > should reject multiple script tags [0.08ms]
(pass) Validate Script Tag > should reject script tag with no script element [0.04ms]
(pass) Validate Script Tag > should handle HTTP URL (not just HTTPS) [0.04ms]
(pass) Validate Script Tag > should handle script tag with URL containing query parameters [0.10ms]
(pass) Validate Script Tag > should handle script tag with URL containing hash fragment [0.05ms]
(pass) Validate Script Tag > should handle empty data attribute value [0.05ms]
(pass) Validate Script Tag > should handle script tag with whitespace around attributes [0.05ms]

server/internal/gradebook-management.test.ts:
50 | 			overrideAccess: true,
51 | 		};
52 | 
53 | 		const instructorResult = await tryCreateUser(instructorArgs);
54 | 
55 | 		expect(instructorResult.ok).toBe(true);
                                   ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/gradebook-management.test.ts:55:31)
(fail) Gradebook Management > (unnamed) [1764.46ms]

server/internal/course-activity-module-link-management.test.ts:
71 | 			},
72 | 			overrideAccess: true,
73 | 		};
74 | 
75 | 		const userResult = await tryCreateUser(userArgs);
76 | 		expect(userResult.ok).toBe(true);
                             ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/course-activity-module-link-management.test.ts:76:25)
(fail) Course Activity Module Link Management Functions > (unnamed) [1747.01ms]

server/internal/quiz-submission-management-time-limit.test.ts:
64 | 			overrideAccess: true,
65 | 		};
66 | 
67 | 		const teacherResult = await tryCreateUser(teacherArgs);
68 | 		if (!teacherResult.ok) {
69 | 			throw new Error("Test Error: Failed to create test teacher");
                  ^
error: Test Error: Failed to create test teacher
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/quiz-submission-management-time-limit.test.ts:69:14)
(fail) Quiz Submission Management - Time Limit > (unnamed) [1822.48ms]

server/internal/appearance-settings.test.ts:
37 | 			},
38 | 			overrideAccess: true,
39 | 		});
40 | 
41 | 		if (!userResult.ok) {
42 | 			throw new Error("Failed to create test user");
                  ^
error: Failed to create test user
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/appearance-settings.test.ts:42:14)
(fail) Appearance Settings Functions > (unnamed) [1726.39ms]

server/internal/enrollment-management.test.ts:
1 | import { buildOrderBy } from './buildOrderBy.js';
2 | import { parseParams } from './parseParams.js';
3 | export const buildQuery = function buildQuery({ adapter, aliasTable, fields, joins = [], locale, parentIsLocalized, selectLocale, sort, tableName, where: incomingWhere }) {
4 |     const selectFields = {
5 |         id: adapter.tables[tableName].id
                               ^
TypeError: undefined is not an object (evaluating 'adapter.tables[tableName].id')
      at buildQuery (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js:5:28)
      at find (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/find/findMany.js:20:53)
      at find (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/find/findMany.js:8:44)
      at find (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/find.js:3:40)
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/payload/dist/collections/operations/find.js:131:39)
(fail) Enrollment Management Functions > (unnamed) [1732.19ms]
1 | import { buildOrderBy } from './buildOrderBy.js';
2 | import { parseParams } from './parseParams.js';
3 | export const buildQuery = function buildQuery({ adapter, aliasTable, fields, joins = [], locale, parentIsLocalized, selectLocale, sort, tableName, where: incomingWhere }) {
4 |     const selectFields = {
5 |         id: adapter.tables[tableName].id
                               ^
TypeError: undefined is not an object (evaluating 'adapter.tables[tableName].id')
      at buildQuery (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js:5:28)
      at find (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/find/findMany.js:20:53)
      at find (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/find/findMany.js:8:44)
      at find (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/find.js:3:40)
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/payload/dist/collections/operations/find.js:131:39)
(fail) Enrollment Management Functions with Authentication > (unnamed) [1766.21ms]

server/internal/activity-module-management.test.ts:
80 | 			overrideAccess: true,
81 | 		};
82 | 
83 | 		const userResult = await tryCreateUser(userArgs);
84 | 
85 | 		expect(userResult.ok).toBe(true);
                             ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/activity-module-management.test.ts:85:25)
(fail) Activity Module Management > (unnamed) [1851.34ms]

server/internal/discussion-management.test.ts:
75 | 			},
76 | 			overrideAccess: true,
77 | 		};
78 | 
79 | 		const teacherResult = await tryCreateUser(teacherArgs);
80 | 		expect(teacherResult.ok).toBe(true);
                                ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/discussion-management.test.ts:80:28)
(fail) Discussion Management - Full Workflow > (unnamed) [1857.84ms]

server/internal/scheduled-tasks-management.test.ts:
1 | import { fieldShouldBeLocalized } from 'payload/shared';
2 | import { isArrayOfRows } from '../../utilities/isArrayOfRows.js';
3 | import { traverseFields } from './traverseFields.js';
4 | export const transformArray = ({ adapter, arrayTableName, baseTableName, blocks, blocksToDelete, data, field, locale, numbers, numbersToDelete, parentIsLocalized, path, relationships, relationshipsToDelete, selects, texts, textsToDelete, withinArrayOrBlockLocale })=>{
5 |     const newRows = [];
6 |     const hasUUID = adapter.tables[arrayTableName]._uuid;
                                       ^
TypeError: undefined is not an object (evaluating 'adapter.tables[arrayTableName]._uuid')
      at transformArray (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/array.js:6:36)
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/traverseFields.js:97:33)
      at forEach (1:11)
      at traverseFields (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/traverseFields.js:18:12)
      at transformForWrite (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/index.js:22:5)
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js:130:25)
      at upsertRow (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js:16:30)
      at create (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/create.js:8:26)
      at async <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/payload/dist/queues/localAPI.js:71:43)
      at async <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/scheduled-tasks-management.test.ts:41:22)
(fail) Scheduled Tasks Management > should correctly identify pending status for future scheduled task [0.97ms]
1 | import { fieldShouldBeLocalized } from 'payload/shared';
2 | import { isArrayOfRows } from '../../utilities/isArrayOfRows.js';
3 | import { traverseFields } from './traverseFields.js';
4 | export const transformArray = ({ adapter, arrayTableName, baseTableName, blocks, blocksToDelete, data, field, locale, numbers, numbersToDelete, parentIsLocalized, path, relationships, relationshipsToDelete, selects, texts, textsToDelete, withinArrayOrBlockLocale })=>{
5 |     const newRows = [];
6 |     const hasUUID = adapter.tables[arrayTableName]._uuid;
                                       ^
TypeError: undefined is not an object (evaluating 'adapter.tables[arrayTableName]._uuid')
      at transformArray (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/array.js:6:36)
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/traverseFields.js:97:33)
      at forEach (1:11)
      at traverseFields (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/traverseFields.js:18:12)
      at transformForWrite (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/index.js:22:5)
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js:130:25)
      at upsertRow (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js:16:30)
      at create (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/create.js:8:26)
      at async <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/payload/dist/queues/localAPI.js:71:43)
      at async <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/scheduled-tasks-management.test.ts:86:22)
(fail) Scheduled Tasks Management > should correctly identify expired status for past scheduled task [0.24ms]
1 | import { fieldShouldBeLocalized } from 'payload/shared';
2 | import { isArrayOfRows } from '../../utilities/isArrayOfRows.js';
3 | import { traverseFields } from './traverseFields.js';
4 | export const transformArray = ({ adapter, arrayTableName, baseTableName, blocks, blocksToDelete, data, field, locale, numbers, numbersToDelete, parentIsLocalized, path, relationships, relationshipsToDelete, selects, texts, textsToDelete, withinArrayOrBlockLocale })=>{
5 |     const newRows = [];
6 |     const hasUUID = adapter.tables[arrayTableName]._uuid;
                                       ^
TypeError: undefined is not an object (evaluating 'adapter.tables[arrayTableName]._uuid')
      at transformArray (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/array.js:6:36)
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/traverseFields.js:97:33)
      at forEach (1:11)
      at traverseFields (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/traverseFields.js:18:12)
      at transformForWrite (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/index.js:22:5)
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js:130:25)
      at upsertRow (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js:16:30)
      at create (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/create.js:8:26)
      at async <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/payload/dist/queues/localAPI.js:71:43)
      at async <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/scheduled-tasks-management.test.ts:134:34)
(fail) Scheduled Tasks Management > should correctly identify completed status for finished task [0.16ms]
1 | import { fieldShouldBeLocalized } from 'payload/shared';
2 | import { isArrayOfRows } from '../../utilities/isArrayOfRows.js';
3 | import { traverseFields } from './traverseFields.js';
4 | export const transformArray = ({ adapter, arrayTableName, baseTableName, blocks, blocksToDelete, data, field, locale, numbers, numbersToDelete, parentIsLocalized, path, relationships, relationshipsToDelete, selects, texts, textsToDelete, withinArrayOrBlockLocale })=>{
5 |     const newRows = [];
6 |     const hasUUID = adapter.tables[arrayTableName]._uuid;
                                       ^
TypeError: undefined is not an object (evaluating 'adapter.tables[arrayTableName]._uuid')
      at transformArray (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/array.js:6:36)
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/traverseFields.js:97:33)
      at forEach (1:11)
      at traverseFields (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/traverseFields.js:18:12)
      at transformForWrite (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/index.js:22:5)
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js:130:25)
      at upsertRow (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js:16:30)
      at create (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/create.js:8:26)
      at async <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/payload/dist/queues/localAPI.js:71:43)
      at async <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/scheduled-tasks-management.test.ts:182:34)
(fail) Scheduled Tasks Management > should correctly identify failed status for failed task [0.29ms]
1 | import { fieldShouldBeLocalized } from 'payload/shared';
2 | import { isArrayOfRows } from '../../utilities/isArrayOfRows.js';
3 | import { traverseFields } from './traverseFields.js';
4 | export const transformArray = ({ adapter, arrayTableName, baseTableName, blocks, blocksToDelete, data, field, locale, numbers, numbersToDelete, parentIsLocalized, path, relationships, relationshipsToDelete, selects, texts, textsToDelete, withinArrayOrBlockLocale })=>{
5 |     const newRows = [];
6 |     const hasUUID = adapter.tables[arrayTableName]._uuid;
                                       ^
TypeError: undefined is not an object (evaluating 'adapter.tables[arrayTableName]._uuid')
      at transformArray (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/array.js:6:36)
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/traverseFields.js:97:33)
      at forEach (1:11)
      at traverseFields (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/traverseFields.js:18:12)
      at transformForWrite (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/index.js:22:5)
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js:130:25)
      at upsertRow (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js:16:30)
      at create (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/create.js:8:26)
      at async <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/payload/dist/queues/localAPI.js:71:43)
      at async <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/scheduled-tasks-management.test.ts:232:34)
(fail) Scheduled Tasks Management > should correctly identify processing status for task being processed [0.21ms]
1 | import { fieldShouldBeLocalized } from 'payload/shared';
2 | import { isArrayOfRows } from '../../utilities/isArrayOfRows.js';
3 | import { traverseFields } from './traverseFields.js';
4 | export const transformArray = ({ adapter, arrayTableName, baseTableName, blocks, blocksToDelete, data, field, locale, numbers, numbersToDelete, parentIsLocalized, path, relationships, relationshipsToDelete, selects, texts, textsToDelete, withinArrayOrBlockLocale })=>{
5 |     const newRows = [];
6 |     const hasUUID = adapter.tables[arrayTableName]._uuid;
                                       ^
TypeError: undefined is not an object (evaluating 'adapter.tables[arrayTableName]._uuid')
      at transformArray (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/array.js:6:36)
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/traverseFields.js:97:33)
      at forEach (1:11)
      at traverseFields (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/traverseFields.js:18:12)
      at transformForWrite (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/transform/write/index.js:22:5)
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js:130:25)
      at upsertRow (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js:16:30)
      at create (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/@payloadcms/drizzle/dist/create.js:8:26)
      at async <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/node_modules/payload/dist/queues/localAPI.js:71:43)
      at async <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/scheduled-tasks-management.test.ts:280:22)
(fail) Scheduled Tasks Management > should calculate statistics correctly [0.20ms]

server/internal/note-management.test.ts:
88 | 		const userResult1 = await tryCreateUser(userArgs1);
89 | 		const userResult2 = await tryCreateUser(userArgs2);
90 | 		const adminResult = await tryCreateUser(adminArgs);
91 | 
92 | 		if (!userResult1.ok || !userResult2.ok || !adminResult.ok) {
93 | 			throw new Error("Failed to create test users");
                  ^
error: Failed to create test users
      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/note-management.test.ts:93:14)
(fail) Note Management Functions > (unnamed) [1762.32ms]

server/internal/user-grade-management.test.ts:
114 | 
115 | 		const adminResult = await tryCreateUser(adminArgs);
116 | 		const instructorResult = await tryCreateUser(instructorArgs);
117 | 		const studentResult = await tryCreateUser(studentArgs);
118 | 
119 | 		expect(adminResult.ok).toBe(true);
                               ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/user-grade-management.test.ts:119:26)
(fail) User Grade Management > (unnamed) [1729.94ms]

server/internal/gradebook-item-management.test.ts:
75 | 		};
76 | 
77 | 		const instructorResult = await tryCreateUser(instructorArgs);
78 | 		const studentResult = await tryCreateUser(studentArgs);
79 | 
80 | 		expect(instructorResult.ok).toBe(true);
                                   ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/internal/gradebook-item-management.test.ts:80:31)
(fail) Gradebook Item Management > (unnamed) [1748.03ms]

server/utils/course-structure-tree.test.ts:
(pass) Course Structure Tree Generation > should generate detailed tree with order information [0.72ms]
(pass) Course Structure Tree Generation > should generate simple tree without order information [0.11ms]
(pass) Course Structure Tree Generation > should handle empty course structure [0.04ms]
(pass) Course Structure Tree Generation > should handle sections with no content [0.03ms]
(pass) Course Structure Tree Generation > should handle deeply nested structure [0.10ms]
(pass) Course Structure Tree Generation > should handle mixed content order correctly [0.04ms]

server/utils/db/seed.test.ts:
31 | 		}
32 | 	});
33 | 
34 | 	test("should successfully seed database without errors", async () => {
35 | 		const result = await tryRunSeed({ payload });
36 | 		expect(result.ok).toBe(true);
                         ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/yomaruhananoshika/repos/@paideia/paideia/server/utils/db/seed.test.ts:36:21)
(fail) Database Seeding > should successfully seed database without errors [1.09ms]

server/json/raw-quiz-config/version-resolver.test.ts:
(pass) raw-quiz-config-version-resolver > should convert v1 regular quiz to v2 with correct discriminated union [0.08ms]
(pass) raw-quiz-config-version-resolver > should convert v1 container quiz to v2 and move resources to nested quizzes [0.09ms]
(pass) raw-quiz-config-version-resolver > should pass through v2 config unchanged [0.03ms]
(pass) raw-quiz-config-version-resolver > should validate quiz configs correctly [0.02ms]
(pass) raw-quiz-config-version-resolver > should safely handle invalid input with try function [0.06ms]
(pass) raw-quiz-config-version-resolver > should convert v1 fill-in-the-blank questions to v2 format [0.11ms]
(pass) raw-quiz-config-version-resolver > should pass through v2 fill-in-the-blank with new blank_id format [0.08ms]

53 tests failed:
(fail) Category Role Management Functions > should prevent duplicate assignments (one role per user per category) [22.11ms]
(fail) Category Role Management Functions > should get all role assignments for a user [24.52ms]
(fail) Category Role Management Functions > should get all role assignments for a category [21.91ms]
(fail) Category Role Management Functions > should find specific role assignment [13.39ms]
(fail) Category Role Management Functions > should check if user has role on category [13.19ms]
(fail) Category Role Management Functions > should get effective role with inheritance from parent category [32.24ms]
(fail) Category Role Management Functions > should respect role priority (admin > coordinator > reviewer) [45.40ms]
(fail) Category Role Management Functions > should get all courses user can access via category roles [67.61ms]
(fail) Category Role Management Functions > should check course access via direct category [35.07ms]
(fail) Category Role Management Functions > should check course access via ancestor category [43.82ms]
(fail) Quiz Attempt Management - Prevent Duplicate Attempts > (unnamed) [1971.22ms]
(fail) Quiz Management - Full Workflow > should create quiz submission (student workflow) [13.97ms]
(fail) Quiz Management - Full Workflow > should update quiz submission (student editing answers) [4.16ms]
(fail) Quiz Management - Full Workflow > should submit quiz (student submits for grading) [4.48ms]
(fail) Quiz Management - Full Workflow > should calculate quiz grade automatically [4.37ms]
(fail) Quiz Management - Full Workflow > should get quiz submission by ID [13.07ms]
(fail) Quiz Management - Full Workflow > should list quiz submissions with filtering [2.50ms]
(fail) Quiz Management - Full Workflow > should handle late submissions [13.53ms]
(fail) Quiz Management - Full Workflow > should prevent duplicate submissions for same attempt [18.36ms]
(fail) Quiz Management - Full Workflow > should only allow grading of completed quizzes [15.44ms]
(fail) Quiz Management - Full Workflow > should delete quiz submission [15.44ms]
(fail) Quiz Management - Full Workflow > should handle pagination in listing [17.84ms]
(fail) Quiz Management - Full Workflow > should reject submission after time limit exceeded [10.35ms]
(fail) Quiz Management - Full Workflow > should auto-submit quiz when timer expires [8.96ms]
(fail) Quiz Attempt Management - Start and Retrieve > (unnamed) [1965.96ms]
(fail) First User Check Functions - With overrideAccess > tryCheckFirstUser > should return true when no users exist [5005.94ms]
  ^ this test timed out after 5000ms.
(fail) First User Check Functions - With overrideAccess > tryCheckFirstUser > should return false when users exist [2.79ms]
(fail) First User Check Functions - With overrideAccess > tryGetUserCount > should return correct user count [0.58ms]
(fail) First User Check Functions - With overrideAccess > tryGetUserCount > should return 0 when no users exist [5000.37ms]
  ^ this test timed out after 5000ms.
(fail) First User Check Functions - With overrideAccess > tryValidateFirstUserState > should return valid state with correct structure [5.77ms]
(fail) First User Check Functions - With overrideAccess > tryValidateFirstUserState > should return isValid=true when database is accessible [1.07ms]
(fail) First User Check Functions - With overrideAccess > tryValidateFirstUserState > should return userCount matching actual database state [10.95ms]
(fail) First User Check Functions - With overrideAccess > Integration Tests > tryCheckFirstUser and tryGetUserCount should be consistent [0.82ms]
(fail) First User Check Functions - With overrideAccess > Integration Tests > tryValidateFirstUserState should match individual function results [0.53ms]
(fail) First User Check Functions - With Access Control > (unnamed) [1830.58ms]
(fail) Gradebook Management > (unnamed) [1764.46ms]
(fail) Course Activity Module Link Management Functions > (unnamed) [1747.01ms]
(fail) Quiz Submission Management - Time Limit > (unnamed) [1822.48ms]
(fail) Appearance Settings Functions > (unnamed) [1726.39ms]
(fail) Enrollment Management Functions > (unnamed) [1732.19ms]
(fail) Enrollment Management Functions with Authentication > (unnamed) [1766.21ms]
(fail) Activity Module Management > (unnamed) [1851.34ms]
(fail) Discussion Management - Full Workflow > (unnamed) [1857.84ms]
(fail) Scheduled Tasks Management > should correctly identify pending status for future scheduled task [0.97ms]
(fail) Scheduled Tasks Management > should correctly identify expired status for past scheduled task [0.24ms]
(fail) Scheduled Tasks Management > should correctly identify completed status for finished task [0.16ms]
(fail) Scheduled Tasks Management > should correctly identify failed status for failed task [0.29ms]
(fail) Scheduled Tasks Management > should correctly identify processing status for task being processed [0.21ms]
(fail) Scheduled Tasks Management > should calculate statistics correctly [0.20ms]
(fail) Note Management Functions > (unnamed) [1762.32ms]
(fail) User Grade Management > (unnamed) [1729.94ms]
(fail) Gradebook Item Management > (unnamed) [1748.03ms]
(fail) Database Seeding > should successfully seed database without errors [1.09ms]

 389 pass
 53 fail
 2 errors
 1772 expect() calls
Ran 442 tests across 40 files. [153.54s]


============================================================
Test Verification Summary
============================================================

 False alarms (12):
  - server/internal/activity-module-management.test.ts
  - server/internal/appearance-settings.test.ts
  - server/internal/check-first-user.test.ts
  - server/internal/course-activity-module-link-management.test.ts
  - server/internal/discussion-management.test.ts
  - server/internal/enrollment-management.test.ts
  - server/internal/gradebook-item-management.test.ts
  - server/internal/gradebook-management.test.ts
  - server/internal/note-management.test.ts
  - server/internal/scheduled-tasks-management.test.ts
  - server/json/raw-quiz-config/version-resolver.test.ts
  - server/utils/db/seed.test.ts

 Real failures (6):
  - server/internal/category-role-management.test.ts
  - server/internal/quiz-submission-management-attempt-start-retrieve.test.ts
  - server/internal/quiz-submission-management-full-workflow.test.ts
  - server/internal/quiz-submission-management-prevent-duplicate-attempts.test.ts
  - server/internal/quiz-submission-management-time-limit.test.ts
  - server/internal/user-grade-management.test.ts
