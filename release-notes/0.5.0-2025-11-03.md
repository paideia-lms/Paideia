# Release Notes - Paideia LMS v0.5.0

**Release Date:** November 3, 2025  
**Version:** 0.5.0

## Overview

Paideia LMS v0.5.0 is a major release introducing comprehensive features for course management, quiz systems, grading, user management, and administrative tools. This release transforms Paideia into a dual-mode application supporting both server and CLI operations, with significant improvements in infrastructure, developer experience, and user functionality.

---

## Major Features

### üéì Course Management System

#### Layered Grade System
- **Comprehensive grading system** with bonus points, penalties, and overrides
- **Single source of truth** for grades eliminating data duplication
- **Flexible grade adjustments** with active/inactive states
- **Complete audit trail** of all grade changes
- Database migration support for existing grade data

#### Hierarchical Course Categories
- **Unlimited nesting** with configurable depth limits
- **Circular reference prevention** and validation
- **Tree structure** with breadcrumb navigation
- **Recursive course counting** for nested categories
- **Category management** with drag-and-drop reparenting

#### Course Module-Specific Settings
- **Versioned JSON schema** for module settings
- **Custom module names** per course instance
- **Time-based access control** for assignments, quizzes, and discussions
- **Due dates and cutoff dates** for submissions
- **Settings inheritance** and template support

#### Course Enrollment Management
- **Comprehensive enrollment interface** with pagination
- **Role-based enrollment** (Student, Teacher, TA, Manager)
- **Status tracking** (Active, Inactive, Completed, Dropped)
- **Bulk enrollment operations** with filtering
- **Enrollment profile pages** with impersonation support

#### Course Search and Filtering
- **Advanced query syntax** with free text and structured filters
- **Status filtering** (published, draft, archived)
- **Category filtering** by ID, name, or uncategorized
- **Combined queries** mixing text and filters
- **Server-side filtering** with URL state persistence

### üìù Quiz System

#### Quiz Preview Component
- **10 question types** including multiple choice, short answer, long answer, article, fill-in-the-blank, choice, ranking, single/multiple selection matrix, and whiteboard
- **Multi-page navigation** with question numbering
- **Global timer** with auto-submit on expiration
- **Question flagging** for review
- **Real-time progress tracking** with visual indicators
- **SSR-safe implementation** with memoized components

#### Nested Quiz Support
- **Container quizzes** with multiple nested quizzes
- **Sequential or free-order completion** modes
- **Independent timers** for parent and nested quizzes
- **Read-only review mode** for completed quizzes
- **Progress tracking** across all nested quizzes

#### Visual Quiz Builder
- **Drag-and-drop interface** for question and page break reordering
- **Tab-based navigation** for container quizzes
- **Inline editing** for question prompts and settings
- **Scoring configuration** with weighted and ranking types
- **Type-safe configuration** with discriminated unions

#### Quiz Builder Improvements
- **Fixed hydration errors** from nested buttons and @dnd-kit
- **Fixed page break conversion** logic to support empty pages
- **Fixed drag-and-drop height distortion** with DragOverlay
- **Client-only rendering** for drag-and-drop components

### üë• User Management

#### Admin User Impersonation
- **Secure impersonation system** with admin-only access
- **Dual user tracking** (authenticated admin vs. effective user)
- **Permission isolation** maintaining separate permission sets
- **Cookie-based session management** with HTTP-only cookies
- **Context-aware redirects** preserving course context

#### User Profile Permission Refactoring
- **Centralized permission logic** with detailed reason messages
- **Field-specific permissions** with clear explanations
- **Loader-level permission checks** for better performance
- **Sandbox mode restrictions** with appropriate messaging
- **First user role protection** with immutable admin role

#### Registration System
- **Public registration page** replacing first-user-only flow
- **Admin-configurable settings** for registration control
- **First-user bypass** for system initialization
- **Auto-login** after successful registration
- **Homepage CTA integration** with conditional display

### üéØ Grading System

#### Assignment Grading Page
- **Dedicated grading interface** for instructors
- **Submission display** with rich text rendering
- **Attachment viewing** with download links
- **Grading form** with score input and feedback editor
- **Multiple access points** from submissions table and history

#### Gradebook Structure Refactoring
- **Extracted structure builder** module for better maintainability
- **Comprehensive test coverage** preventing root item duplication
- **Recursive category building** with proper nesting
- **Type-safe implementation** with clear interfaces

### üìä Dashboard

#### Interactive Curriculum Map
- **44-course curriculum** visualization using React Flow
- **Prerequisite connections** with bezier curves
- **Semester-based layout** with 8 semesters
- **Status badges** (completed, active, inactive)
- **Color-coded nodes** and animated edges
- **Pan and zoom controls** with fitView

#### Dashboard Features
- **Personalized greeting** with time-based messages
- **Program information** display
- **Recent courses** with progress tracking
- **Calendar widget** showing today's schedule
- **Recent notes** sidebar
- **Public homepage** with featured courses and platform showcase

### üîß Admin Features

#### System Information Page
- **Platform detection** (Coolify, Fly.io, Railway, Render, Vercel, etc.)
- **Real-time system resources** monitoring (memory, CPU, disk, OS)
- **Auto-refresh** every second for live monitoring
- **Color-coded status** indicators (green/yellow/red)
- **Uptime and load average** display

#### Test Email Page
- **SMTP and Resend adapter support** with priority-based selection
- **Configuration detection** and status display
- **Predefined test messages** with system information
- **Custom message support** with HTML formatting
- **Warning system** for unconfigured email

#### Database Migration Management
- **Migration status viewing** through UI
- **Database dump functionality** using Drizzle ORM (version-independent)
- **CLI dump command** (`paideia migrate dump`)
- **Dump file organization** in `paideia_data/` directory
- **No external CLI dependencies** required

#### Category Management
- **Drag-and-drop category tree** with reparenting
- **Details pane** with course counts and ancestors
- **Edit and delete** operations with validation
- **Batch course updates** (category and status)
- **Query-state driven modals** for better deep-linking

### üõ†Ô∏è CLI Features

#### Dual-Mode Binary
- **Server and CLI modes** in single binary
- **Commander.js integration** for command parsing
- **ASCII logo** display
- **Migration commands** (status, up, down, refresh, reset, fresh, dump)
- **Help command** with comprehensive documentation

#### Sandbox Mode
- **Automatic database reset** on startup and daily at midnight
- **Custom seed data** support via `seed.json` file
- **Zod schema validation** for seed data
- **Site-wide warning alert** when enabled
- **Development and testing** focused

### üìù Content Features

#### D2 Diagram Support
- **Server-side compilation** via D2 CLI
- **Rich text editor integration** with language selection
- **Automatic SVG rendering** replacing code blocks
- **Error handling** with user-friendly messages
- **Dark mode support**

#### Notes Page Improvements
- **Timezone fix** using client hints
- **Query state management** with URL parameters
- **Component refactoring** into focused sections
- **Interactive heatmap** with clickable dates
- **Calendar enhancements** with tooltips and indicators

### üîÑ Activity Module Access Control

#### Access Grant System
- **Activity module grants** collection for access tracking
- **Ownership transfer** with automatic grant creation
- **Permission matrix** (owner, granted user, creator, admin)
- **Config collection inheritance** from parent modules
- **Transaction-based** operations for data integrity

---

## Technical Improvements

### Form Data Parser Fallback
- **Automatic fallback** for Bun compiled mode
- **FileUpload adapter** maintaining backward compatibility
- **Memory efficient** with request cloning only on first test
- **Graceful error handling** for stream-related errors

### Native Dependency Management
- **Automated detection script** for native dependencies
- **Build process integration** with pre-cleanup checks
- **Sharp removal** from media collection
- **Pure JavaScript bundle** ensuring cross-platform compatibility

### API Improvements

#### Note Management API
- **Object-based arguments** replacing positional parameters
- **Explicit user authentication** avoiding redundant payload.auth() calls
- **Performance optimization** with pre-authenticated users
- **Type-safe interfaces** for all function parameters

#### Email Adapter Support
- **Resend adapter** with priority over SMTP
- **Shared configuration** (from address and name)
- **Environment variable** based configuration
- **Test email page** updates showing provider status

### Infrastructure Improvements

#### Build System
- **Single command** builds both macOS and Linux ARM64 binaries
- **Cross-compilation** without Docker
- **Native dependency checking** before build cleanup
- **Version-independent** database dumps using Drizzle ORM

#### Docker Compose
- **Split configuration** (infrastructure vs. application)
- **Development workflow** improvements
- **Accidental startup prevention** for Paideia container

---

## Bug Fixes

### Quiz Builder
- ‚úÖ Fixed React hydration errors from nested buttons
- ‚úÖ Fixed page break conversion logic for empty pages
- ‚úÖ Fixed drag-and-drop height distortion with DragOverlay
- ‚úÖ Fixed @dnd-kit hydration mismatch with client-only rendering

### Notes Page
- ‚úÖ Fixed timezone discrepancy causing wrong date filtering
- ‚úÖ Fixed date parsing inconsistencies with safe date utilities
- ‚úÖ Improved component organization and query state management

### Form Data Parsing
- ‚úÖ Fixed form data parser failure in Bun compiled mode
- ‚úÖ Added automatic fallback to native FormData API
- ‚úÖ Maintained backward compatibility with existing upload handlers

### Native Dependency Check
- ‚úÖ Fixed relative import detection in check script
- ‚úÖ Improved package analysis with multiple detection methods
- ‚úÖ Added proper error handling and reporting

---

## Breaking Changes

### Registration Route
- **Route change**: `/first-user` ‚Üí `/registration`
- Old route redirects to new route automatically
- Update any bookmarks or external links

### Permission Functions
- **Return type change**: All permission functions now return `PermissionResult` instead of `boolean`
- Components must use `.allowed` property instead of direct boolean
- Reason messages available via `.reason` property

### Media Collection
- **Image sizes removed**: No automatic image resizing
- Sharp dependency removed from package.json
- Original images stored as-is without thumbnails

---

## Migration Guide

### Database Migrations
Run migrations to apply schema changes:
```bash
bun run payload migrate
```

### Permission Function Updates
Update all permission function calls:
```typescript
// Old
const canEdit = canEditProfileFirstName(...);

// New
const permission = canEditProfileFirstName(...);
const canEdit = permission.allowed;
```

### Email Configuration
No changes required for existing SMTP configuration. To use Resend:
1. Set `RESEND_API_KEY` environment variable
2. Optionally set `EMAIL_FROM_ADDRESS` and `EMAIL_FROM_NAME`

### Registration Settings
New registration settings global created automatically with defaults:
- `disableRegistration: false`
- `showRegistrationButton: true`

---

## Developer Experience

### Type Safety
- **Discriminated unions** for quiz scoring types
- **Type guards** for container vs. regular quizzes
- **Strict null checks** throughout codebase
- **No type casting** in internal functions

### Testing
- **Comprehensive test coverage** for gradebook structure
- **Test suites** for email functionality
- **Sandbox mode** for automated testing
- **Native dependency checking** in CI/CD

### Code Organization
- **Extracted modules** for better maintainability
- **Centralized utilities** for common operations
- **Consistent patterns** across codebase
- **Clear separation** of concerns

---

## Performance Improvements

- **Loader-level permission checks** reducing redundant calculations
- **Memoized components** preventing unnecessary re-renders
- **Debounced search inputs** reducing API calls
- **Server-side filtering** reducing client-side computation
- **Efficient database queries** with proper depth handling

---

## Security Enhancements

- **Admin-only access** for sensitive operations
- **Permission validation** server-side
- **Impersonation security** with admin-only access
- **Sandbox mode warnings** for development environments
- **Secure cookie management** for impersonation sessions

---

## Documentation

- **31 comprehensive changelogs** covering all features
- **Usage examples** for all major features
- **Migration guides** for breaking changes
- **Best practices** for timezone handling, date formatting, and more
- **API documentation** with type definitions

---

## Future Enhancements

### Planned Features
- Grade letter calculation from grade tables
- Automated grade calculation from submission scores
- Grade analytics and reporting
- Quiz grading for objective questions
- Batch grading workflows
- Rubric support for assignments
- Inline comments on submissions

### Infrastructure
- Migration creation CLI command
- Seed command for database seeding
- Health check CLI command
- Additional email providers support
- Image processing with pure JavaScript libraries

---

## Dependencies

### New Dependencies
- `commander` - CLI command parsing
- `@xyflow/react` - Curriculum map visualization
- `@epic-web/client-hints` - Client timezone detection
- `search-query-parser` - Advanced search syntax parsing

### Removed Dependencies
- `sharp` - Native image processing (replaced with no automatic resizing)

### Updated Dependencies
- All existing dependencies updated to latest compatible versions

---

## Contributors

This release represents significant work across multiple areas:
- Core LMS functionality
- Quiz and assessment systems
- Grading and course management
- Admin tools and utilities
- CLI and infrastructure improvements
- Developer experience enhancements

---

## Thank You

Thank you for using Paideia LMS. This release brings substantial improvements to functionality, developer experience, and infrastructure. We're committed to continuing to improve the platform based on your feedback.

For questions, issues, or contributions, please visit our GitHub repository: https://github.com/paideia-lms/paideia

---

## Complete Changelog Reference

This release includes all changes from changelogs 0001 through 0031:

### Core Features (0001-0006)
- **0001** - Layered Grade System: Comprehensive grading with bonus points, penalties, and overrides
- **0002** - Note Management API Changes: Object-based arguments with explicit user authentication
- **0003** - Hierarchical Course Categories: Unlimited nesting with circular reference prevention
- **0004** - Activity Module Access Control: Access grants and ownership transfer system
- **0005** - Admin User Impersonation System: Secure impersonation with dual user tracking
- **0006** - Course Enrollment Management: Comprehensive enrollment interface with pagination

### Quiz System (0007-0012)
- **0007** - Quiz Preview Component: 10 question types with multi-page navigation and timers
- **0008** - Nested Quiz Support: Container quizzes with sequential/free-order completion
- **0009** - Quiz Scoring Type Refinements: Discriminated unions for type-safe scoring
- **0010** - Quiz Builder Nested Button Fix: Fixed React hydration errors
- **0010** - Visual Quiz Builder with Drag-Drop: Drag-and-drop interface for quiz building
- **0011** - Quiz Builder Page Break Fix: Fixed page break conversion logic
- **0012** - Quiz Builder Drag Drop UI Fix: Fixed height distortion with DragOverlay

### Dashboard & Content (0013-0016)
- **0013** - Dashboard with Curriculum Map: Interactive 44-course curriculum visualization
- **0014** - D2 Diagram Support: Server-side diagram compilation via D2 CLI
- **0015** - Course Module-Specific Settings: Versioned JSON schema for module settings
- **0016** - Assignment Grading Page: Dedicated grading interface for instructors
- **0016** - Course Enrollment Profile Page: Profile pages with impersonation support

### Admin Tools (0017-0021)
- **0017** - Admin System Information Page: Platform detection and system resource monitoring
- **0018** - Admin Test Email Page: SMTP and Resend adapter support with configuration testing
- **0019** - Admin Category Management Pages: Drag-and-drop category tree with batch updates
- **0020** - Course Search with Advanced Filters: Advanced query syntax with structured filters
- **0021** - Registration and Admin Settings: Public registration with admin-configurable settings

### Infrastructure & Developer Experience (0022-0024)
- **0022** - Gradebook Structure Building Refactor: Extracted structure builder with test coverage
- **0023** - Form Data Parser Fallback for Bun Compiled Mode: Automatic fallback for compiled binaries
- **0024** - Notes Page Timezone Fix and Improvements: Timezone fix with client hints and query state

### CLI & Operations (0025-0030)
- **0025** - Admin Database Migration Management: Migration status viewing and database dumps
- **0026** - Paideia CLI Mode: Dual-mode binary with Commander.js integration
- **0027** - Sandbox Mode: Automatic database reset with custom seed data support
- **0028** - User Profile Permission Refactoring: Centralized permission logic with reason messages
- **0029** - Resend Email Adapter Support: Priority-based email adapter selection
- **0030** - CLI Database Dump Command: CLI dump command with file organization

### Build & Infrastructure (0031)
- **0031** - Native Dependency Check and Sharp Removal: Automated detection and pure JavaScript bundle

---

**Full Changelog Details**: See individual changelog files in `changelogs/` directory for detailed information about each feature and change.

