# Release Notes - Paideia LMS v0.7.2

**Release Date:** November 21, 2025  
**Version:** 0.7.2  
**Type**: Feature Release & Improvements  
**Impact**: Medium - RTL/LTR direction support, enhanced grading workflows, and improved gradebook management  
**Changelog**: 0062, 0063, 0064, 0065, 0066

## Overview

Paideia LMS v0.7.2 introduces significant enhancements to RTL/LTR direction support, discussion grading, and gradebook management. This release adds right-to-left (RTL) text direction support, completes the discussion grading workflow with grade release functionality, introduces extra credit categories, and provides comprehensive weight validation and deletion capabilities for gradebook items and categories. The release also includes UI improvements for sandbox mode and comprehensive feature comparison documentation.

---

## Major Features

### üåç Direction Support (RTL/LTR)

**New Feature**: Full support for right-to-left (RTL) and left-to-right (LTR) text direction, enabling proper support for RTL languages like Arabic, Hebrew, and Persian.

**What's New**:
- **User Direction Preference**: Users can choose their preferred text direction (LTR or RTL) in the preferences page
- **Mantine RTL Integration**: Leverages Mantine's built-in `DirectionProvider` for automatic component adaptation
- **JWT Integration**: Direction preference is saved to JWT for quick access during authentication
- **HTML Direction Attribute**: Automatically sets `dir` attribute on HTML element based on user preference
- **Default Behavior**: All existing users default to "ltr" (left-to-right)

**User Experience**:
- **For All Users**:
  - Choose text direction in User ‚Üí Preferences
  - Preference persists across sessions
  - Entire application interface adapts to selected direction
  - All Mantine components automatically flip layout, spacing, and positioning
  - Icons and text alignment adjust automatically

- **For RTL Language Speakers**:
  - Proper support for Arabic (ÿßŸÑÿπÿ±ÿ®Ÿäÿ©), Hebrew (◊¢◊ë◊®◊ô◊™), Persian/Farsi (ŸÅÿßÿ±ÿ≥€å), Urdu (ÿßÿ±ÿØŸà), and other RTL languages
  - Improved accessibility and readability for RTL language users
  - Better user experience when using RTL languages in the interface

**Technical Details**:
- Direction field added to Users collection with enum type (`ltr` | `rtl`)
- Default value "ltr" ensures backward compatibility
- DirectionProvider wraps entire application for consistent behavior
- No additional component-level changes needed - Mantine handles RTL automatically

---

### üí¨ Discussion Grading and Grade Release

**New Feature**: Complete discussion grading workflow with per-post grading and grade release to the gradebook.

**What's New**:
- **Per-Post Grading**: Grade individual discussion posts (threads, replies, and comments) with dedicated forms
- **Context Display**: View full conversation chain with ancestor posts when grading replies and comments
- **Grade Storage**: Grades stored directly on discussion submissions with `grade`, `feedback`, `gradedBy`, and `gradedAt` fields
- **Grade Release**: Release discussion grades to the gradebook with automatic average calculation
- **Status Tracking**: Submission table shows "Graded", "Partially Graded", or "Not Graded" status
- **Score Display**: Shows average score from graded posts / max score

**User Experience**:
- **For Teachers**:
  - Grade individual posts with context from ancestor conversations
  - See author information (avatar, name, profile link) for each post
  - View timestamps (published/created) for better context
  - Collapse/expand ancestor posts to focus on specific conversations
  - Release grades to gradebook when ready (calculates average automatically)
  - Clear status indicators show grading progress per student

- **For Students**:
  - See grading status for their discussion participation
  - View average scores from graded posts
  - Receive feedback on individual posts

**Key Workflow**:
1. Instructor grades individual discussion posts using per-post forms
2. Grades are stored directly on `discussion-submissions` collection
3. When ready, instructor clicks "Release Grade" button
4. System calculates average from all graded posts (ignores ungraded posts)
5. Average grade is stored in user-grades for gradebook display

**Technical Details**:
- Module-specific grade release functions: `tryReleaseAssignmentGrade`, `tryReleaseDiscussionGrade`, `tryReleaseQuizGrade`
- Average calculation excludes ungraded posts
- Combines feedback from all graded submissions
- Validates grades against gradebook item min/max limits when available

---

### üìä Gradebook Extra Credit Categories

**New Feature**: Support for extra credit categories and automatic handling of auto-weighted-zero categories.

**What's New**:
- **Extra Credit Categories**: Mark gradebook categories as extra credit to allow totals exceeding 100%
- **Auto-Weighted-Zero Categories**: Categories with no non-extra-credit items are automatically marked as auto-weighted-zero
- **Two-Pass Weight Calculation**: Refactored algorithm identifies auto-weighted-zero categories before weight distribution
- **Enhanced Weight Totals**: Total display includes both extra credit items and categories separately
- **UI Improvements**: Conditional weight fields, informative alerts, and improved tooltips

**User Experience**:
- **For Teachers**:
  - Mark categories as extra credit (only when category has items and weight)
  - See auto-weighted-zero categories displayed as "auto (0%)" with explanatory tooltip
  - Weight fields only appear when category has items
  - Clear alerts explain when weight can be changed
  - Total tooltip shows both extra credit items and categories with their weights

**Category Workflow**:
1. Create category without weight or extra credit options
2. Add items to category
3. Set weight and optionally mark as extra credit
4. System validates extra credit categories must have weight specified

**Technical Details**:
- Extra credit categories contribute to `extraCreditTotal` and allow totals to exceed 100%
- Auto-weighted-zero categories are excluded from weight distribution
- Two-pass algorithm: first identifies auto-weighted-zero, then calculates weights
- Categories cannot be created as extra credit (must be set after items are added)

---

### ‚öñÔ∏è Gradebook Weight Validation and Deletion

**New Feature**: Comprehensive weight validation system and deletion functionality for gradebook items and categories.

**What's New**:
- **Unified Weight Validation**: Centralized `tryValidateOverallWeightTotal` function ensures non-extra-credit items always sum to exactly 100%
- **Item Deletion**: Delete manual gradebook items (items not linked to activity modules)
- **Category Deletion**: Delete gradebook categories with validation for empty categories
- **Transaction Support**: All operations use database transactions for atomic operations
- **Weight Display Formatting**: All weights display with 2 decimal places for consistency

**User Experience**:
- **For Teachers**:
  - Delete manual items with confirmation dialog
  - Delete empty categories (must have no subcategories and no items)
  - Automatic weight validation after create, update, or delete operations
  - Clear error messages when weight totals don't equal 100%
  - Consistent weight display format (2 decimal places) throughout interface

**Validation Workflow**:
1. Operation performed (create, update, or delete)
2. Transaction started for atomic operation
3. System calculates overall weights for all non-extra-credit items
4. Validates `baseTotal` equals exactly 100% (within 0.01 tolerance)
5. Success: Transaction commits and operation completes
6. Failure: Transaction rolls back and error is thrown

**Technical Details**:
- Extra credit items are excluded from 100% validation requirement
- Only manual items (not linked to activity modules) can be deleted
- Categories can only be deleted if empty (no subcategories, no items)
- All validation occurs within database transactions
- Weight validation applies to item create, update, delete and category create, update, delete

---

## Improvements and Enhancements

### Sandbox Mode

**Visual Enhancements**:
- **Sandbox Countdown**: Real-time countdown timer showing time remaining until next sandbox reset
- **Fixed Position**: Countdown displayed at bottom-right corner (non-intrusive)
- **Auto-Updates**: Updates every second with formatted time display (hours, minutes, seconds)
- **Auto-Hide**: Automatically stops when countdown reaches zero

**User Experience**:
- Users are aware of when the system will reset
- Clear visual indication of time remaining
- Non-intrusive positioning doesn't obstruct main content
- Works seamlessly with existing sandbox mode warning alert

### Documentation

**Feature Comparison**:
- **Moodle Comparison**: Comprehensive feature list comparing Moodle LMS and Paideia LMS feature parity
- **Organized by Category**: Features organized into Site Features, User Features, Course Features, Resources and Activities, and Blocks
- **Status Indicators**: Clear status indicators (‚úî = Supported, X = Not Supported)
- **Reference Material**: Based on Moodle's official feature comparison documentation (April 2025)

**Use Cases**:
- Track feature parity between Paideia LMS and Moodle LMS
- Identify gaps in feature coverage
- Plan feature development priorities
- Reference for migration from Moodle to Paideia

---

## Migration Guide

### Database Migration

This release includes a database migration that adds direction support, discussion grading fields, extra credit categories, and updates weight column constraints.

**Migration Steps**:
1. Upgrade to v0.7.2
2. The migration will be automatically applied when you start the server, or you can manually run:
   ```bash
   bun run payload migrate
   ```
3. The migration will:
   - Add `direction` enum type and column to `users` table (defaults to 'ltr')
   - Add `extra_credit` column to `gradebook_categories` table (defaults to false)
   - Add `grade`, `feedback`, `graded_by_id`, and `graded_at` columns to `discussion_submissions` table
   - Drop default values from `weight` columns in `gradebook_categories` and `gradebook_items`
   - Make `weight` column nullable in `gradebook_items` table (supports auto-weighting)

**What the Migration Does**:
- Creates direction enum type for user text direction preference
- Adds discussion grading fields for per-post grading
- Adds extra credit support for gradebook categories
- Updates weight columns to support auto-weighting (null = auto-weighted, 0 = explicitly 0 weight)
- All changes are backward compatible

**After Migration**:
- ‚úÖ Server starts successfully
- ‚úÖ All existing users default to "ltr" direction
- ‚úÖ All existing categories default to `extraCredit: false`
- ‚úÖ Existing discussion submissions have `null` values for new grading fields
- ‚úÖ Existing weight values (0) are preserved (not converted to null)
- ‚úÖ All new features are immediately available

**Important Notes**:
- Existing users will automatically get "ltr" direction (default)
- Existing categories will have `extraCredit: false` (default)
- Existing weight values of 0 remain as 0 (intentional - null means auto-weighted, 0 means explicitly 0 weight)
- No data loss or breaking changes

---

## Breaking Changes

None. All changes are backward compatible.

---

## Dependencies

No new dependencies added in this release.

---

## Testing

### Direction Support
- ‚úÖ Direction selection appears in preferences page
- ‚úÖ Direction preference saves and persists after page refresh
- ‚úÖ Direction change updates entire UI
- ‚úÖ HTML `dir` attribute is set correctly
- ‚úÖ Default direction "ltr" for new users
- ‚úÖ All Mantine components adapt to RTL direction

### Discussion Grading
- ‚úÖ Per-post grading forms function correctly
- ‚úÖ Context collapse shows ancestor posts
- ‚úÖ Grade release calculates average correctly
- ‚úÖ Ungraded posts are excluded from average calculation
- ‚úÖ Status indicators display correctly (Graded, Partially Graded, Not Graded)
- ‚úÖ Score display shows average / max score

### Gradebook Features
- ‚úÖ Extra credit categories contribute to extra credit total
- ‚úÖ Auto-weighted-zero categories are excluded from weight distribution
- ‚úÖ Weight validation ensures 100% total for non-extra-credit items
- ‚úÖ Item deletion validates weight total after deletion
- ‚úÖ Category deletion validates empty category requirement
- ‚úÖ Weight display shows 2 decimal places consistently

### Sandbox Countdown
- ‚úÖ Countdown displays when sandbox mode is enabled
- ‚úÖ Countdown updates every second
- ‚úÖ Time format adapts based on remaining duration
- ‚úÖ Countdown stops at zero

---

## Upgrade Instructions

### From v0.7.1 or Earlier

1. **Check migration status** (optional):
   ```bash
   bun run payload migrate:status
   ```

2. **Upgrade to v0.7.2**:
   ```bash
   git pull origin next  # or your branch
   ```

3. **Start the server** (migration will be applied automatically):
   ```bash
   bun run dev
   ```
   
   Or manually apply the migration first:
   ```bash
   bun run payload migrate
   bun run dev
   ```

4. **Configure Direction** (optional):
   - Navigate to User ‚Üí Preferences
   - Select your preferred text direction (LTR or RTL)
   - Save changes

5. **Explore New Features**:
   - Try grading discussion posts with per-post forms
   - Mark categories as extra credit in gradebook setup
   - Delete manual items and empty categories
   - Check sandbox countdown if sandbox mode is enabled

---

## What's Next

This release significantly enhances RTL/LTR direction support, completes the discussion grading workflow, and provides powerful gradebook management features. Future releases will continue to build on these foundations with:

- Quiz grade release implementation (currently placeholder)
- Bulk grading operations for multiple posts
- Grade templates or rubrics for discussion posts
- Visual indicators for auto-weighted-zero categories in gradebook structure

---

## Thank You

Thank you for using Paideia LMS. This release brings important improvements to RTL/LTR direction support, discussion grading, and gradebook management, making the platform more accessible to RTL language users and providing more flexible grading workflows for educators.

For questions, issues, or contributions, please visit our GitHub repository: https://github.com/paideia-lms/paideia

---

## Complete Changelog Reference

This release includes changes from changelogs 0062, 0063, 0064, 0065, and 0066:

### Sandbox Countdown and Feature Comparison (0062)
- **0062** - Sandbox Countdown: Real-time countdown timer for sandbox resets
- **0062** - Feature Comparison Documentation: Comprehensive Moodle feature comparison
- **0062** - Visual Enhancements: Non-intrusive countdown display
- **0062** - Documentation: Organized feature list by category

### Direction Support (0063)
- **0063** - RTL/LTR Support: Full text direction support for RTL languages
- **0063** - User Preference: Direction selection in preferences page
- **0063** - Mantine Integration: Automatic component adaptation via DirectionProvider
- **0063** - JWT Integration: Direction saved to JWT for quick access
- **0063** - HTML Direction: Automatic `dir` attribute on HTML element

### Discussion Grading and Grade Release (0064)
- **0064** - Per-Post Grading: Grade individual discussion posts with dedicated forms
- **0064** - Context Display: View ancestor posts when grading replies and comments
- **0064** - Grade Release: Release discussion grades to gradebook with average calculation
- **0064** - Status Tracking: Graded, Partially Graded, or Not Graded status indicators
- **0064** - Score Display: Average score from graded posts / max score

### Gradebook Weight Validation and Deletion (0065)
- **0065** - Unified Weight Validation: Centralized validation ensures 100% total
- **0065** - Item Deletion: Delete manual gradebook items with confirmation
- **0065** - Category Deletion: Delete empty categories with validation
- **0065** - Transaction Support: Atomic operations with transaction management
- **0065** - Weight Formatting: Consistent 2 decimal place display

### Gradebook Extra Credit Categories (0066)
- **0066** - Extra Credit Categories: Mark categories as extra credit
- **0066** - Auto-Weighted-Zero: Automatic detection and handling of empty categories
- **0066** - Two-Pass Algorithm: Refactored weight calculation with two-pass approach
- **0066** - Enhanced Totals: Display extra credit items and categories separately
- **0066** - UI Improvements: Conditional fields, alerts, and improved tooltips

**Full Changelog Details**: See changelog files:
- `changelogs/0062-2025-11-19-sandbox-countdown-and-feature-comparison-documentation.md`
- `changelogs/0063-2025-11-19-direction-support.md`
- `changelogs/0064-2025-11-19-discussion-grading-and-grade-release.md`
- `changelogs/0065-2025-11-19-gradebook-item-weight-validation-and-deletion.md`
- `changelogs/0066-2025-11-20-gradebook-extra-credit-categories-and-auto-weighted-zero.md`

**Previous Release**: See [v0.7.1 Release Notes](./0.7.1-2025-11-19.md) for previous features.

