# Release Notes - Paideia LMS v0.5.2

**Release Date:** November 3, 2025  
**Version:** 0.5.2  
**Type**: Feature Enhancement  
**Impact**: Low - Adds flexibility for CORS configuration via environment variables  
**Changelog**: 0033

## Overview

Paideia LMS v0.5.2 is a patch release that adds configurable CORS (Cross-Origin Resource Sharing) origins support via environment variables. This release allows administrators to configure allowed CORS origins without code changes, making it easier to deploy in different environments.

---

## Features Added

### üîê Configurable CORS Origins

**Problem**: CORS origins were hardcoded in the configuration, making it difficult to configure for different environments (development, staging, production) without modifying code.

**Solution**: Added `CORS_ORIGINS` environment variable support with flexible configuration options.

**Features**:
- **Environment variable-based configuration**: Configure CORS via `.env` file or environment variables
- **Wildcard support**: Use `*` to allow all origins (useful for development)
- **Multiple origins**: Specify comma-separated URLs for multiple allowed origins
- **Backward compatible**: Defaults to localhost if not configured
- **Automatic trimming**: URLs are automatically trimmed and filtered

**Configuration Examples**:

**Default (localhost only)**:
```env
# Leave CORS_ORIGINS unset or empty
```

**Wildcard (all origins - development only)**:
```env
CORS_ORIGINS=*
```

**Specific origins (comma-separated)**:
```env
CORS_ORIGINS=http://localhost:3001,https://example.com,https://*.localcan.dev
```

**Production example**:
```env
CORS_ORIGINS=https://paideialms.com,https://www.paideialms.com
```

**Benefits**:
- ‚úÖ Flexible CORS configuration without code changes
- ‚úÖ Environment-specific configuration support
- ‚úÖ Backward compatible (defaults to localhost)
- ‚úÖ Supports wildcard for development
- ‚úÖ Supports multiple specific origins for production
- ‚úÖ Easy to configure via `.env` file or environment variables

---

## Bug Fixes

### Cookie Domain Fix for IP Addresses

**Problem**: Cookies were not being set when accessing the application via IP address (e.g., `http://100.84.175.40:3000/`).

**Root Cause**: IP addresses cannot be used as cookie domain attributes. Browsers reject cookies with IP addresses as the domain.

**Solution**:
- Added IP address detection (IPv4 and IPv6) in cookie domain extraction
- For IP addresses, domain attribute is omitted entirely (similar to localhost)
- Updated secure flag logic to handle IP addresses correctly

**Benefits**:
- ‚úÖ Cookies now work correctly when accessing via IP address
- ‚úÖ Login works via IP addresses (e.g., `http://100.84.175.40:3000`)
- ‚úÖ Cookies work for both IPv4 and IPv6 addresses

---

## Migration Guide

### CORS Configuration

**No migration required.** The update is backward compatible. Existing installations will continue to work with default localhost CORS configuration.

**To configure CORS origins**:

1. **Add `CORS_ORIGINS` to your `.env` file**:
   ```env
   CORS_ORIGINS=http://localhost:3001,https://example.com
   ```

2. **Or set it as an environment variable**:
   ```bash
   export CORS_ORIGINS="https://example.com,https://*.localcan.dev"
   ```

3. **Restart the application** to apply changes

### Cookie Configuration

**No migration needed.** The changes are automatic and backward compatible:

- ‚úÖ IP addresses now work correctly (domain omitted)
- ‚úÖ Localhost continues to work (domain omitted)
- ‚úÖ Regular domains continue to work (domain set correctly)
- ‚úÖ Subdomains continue to work (parent domain set correctly)

---

## Breaking Changes

None. All changes are backward compatible.

---

## Dependencies

No new dependencies added.

---

## Testing

- ‚úÖ Default CORS configuration works (localhost)
- ‚úÖ Wildcard CORS configuration works (`*`)
- ‚úÖ Comma-separated URLs are parsed correctly
- ‚úÖ Cookies work correctly via IP address
- ‚úÖ Cookies work correctly via localhost
- ‚úÖ Cookies work correctly via domain names
- ‚úÖ Cookies work correctly via subdomains
- ‚úÖ Backward compatible with existing installations

---

## Environment Variables

### New Optional Environment Variable

**`CORS_ORIGINS`**:
- **Type**: String (comma-separated URLs or `*`)
- **Required**: No
- **Default**: `http://localhost:${PORT}` (typically `http://localhost:3001`)
- **Description**: CORS allowed origins. Can be:
  - Unset/empty: Defaults to localhost
  - `*`: Allows all origins (not recommended for production)
  - Comma-separated URLs: Allows specific origins (e.g., `http://localhost:3001,https://example.com`)

**Example**:
```env
CORS_ORIGINS=http://localhost:3001,https://example.com,https://*.localcan.dev
```

See `server/env.ts` for the complete list of environment variables.

---

## Thank You

Thank you for using Paideia LMS. This patch release adds flexibility for CORS configuration and fixes cookie handling for IP addresses. We're committed to continuing to improve the platform based on your feedback.

For questions, issues, or contributions, please visit our GitHub repository: https://github.com/paideia-lms/paideia

---

## Complete Changelog Reference

This release includes all changes from changelog 0033:

### Configuration & Bug Fixes (0033)
- **0033** - Configurable CORS Origins: Environment variable-based CORS configuration with wildcard and comma-separated URL support
- **0033** - Cookie Domain Fix for IP Addresses: Fixed cookies not being set when accessing via IP address

### Detailed Changelog

#### Configurable CORS Origins
- Added `CORS_ORIGINS` environment variable support
- Supports wildcard (`*`) for development
- Supports comma-separated URLs for multiple origins
- Backward compatible (defaults to localhost if not set)
- Automatic URL trimming and filtering

#### Cookie Domain Fix for IP Addresses
- Added IP address detection (IPv4 and IPv6) in cookie domain extraction
- For IP addresses, domain attribute is omitted entirely (browsers reject IP addresses as cookie domains)
- Updated secure flag logic to handle IP addresses correctly
- Cookies now work correctly when accessing via IP address (e.g., `http://100.84.175.40:3000`)

---

**Full Changelog Details**: See changelog file `changelogs/0033-2025-11-03-configurable-cors-origins.md` for detailed information about each feature and change.

