# Release Notes - Paideia LMS v0.5.4

**Release Date:** November 3, 2025  
**Version:** 0.5.4  
**Type**: Feature Enhancement  
**Impact**: Medium - Enables Docker deployment on AMD64 servers and adds D2 diagram rendering support  
**Changelog**: 0035

## Overview

Paideia LMS v0.5.4 is a patch release that adds multi-platform Docker support for both ARM64 and AMD64 architectures, enabling deployment on a wider range of servers including Hetzner and other AMD64-based hosting providers. This release also includes D2 CLI installation in the Docker image for diagram rendering capabilities.

---

## Features Added

### üê≥ Multi-Platform Docker Support

**Problem**: Docker images were only built for ARM64 architecture, causing "no matching manifest for linux/amd64" errors when pulling images on AMD64 servers (e.g., Hetzner).

**Solution**: Added multi-platform Docker support for both ARM64 and AMD64 architectures.

**Features**:
- **Multi-platform builds**: Docker images now support both ARM64 and AMD64
- **Automatic platform selection**: Docker automatically selects the correct platform variant when pulling
- **Single image tag**: One image tag supports multiple architectures
- **Better compatibility**: Works with various hosting providers (Hetzner, AWS, DigitalOcean, etc.)

**Technical Details**:
- Updated Dockerfile to use `TARGETARCH` for platform-specific binary selection
- Updated GitHub Actions workflow to build and push multi-platform images
- Added support for both `linux/arm64` and `linux/amd64` platforms

**Benefits**:
- ‚úÖ Docker images work on both ARM64 and AMD64 servers
- ‚úÖ No more "no matching manifest" errors on AMD64 servers
- ‚úÖ Automatic platform selection when pulling images
- ‚úÖ Single image tag supports multiple architectures
- ‚úÖ Better compatibility with various hosting providers

**Example**:
```bash
# Works on both ARM64 and AMD64 servers
docker pull ghcr.io/paideia-lms/paideia:latest
# Docker automatically selects the correct platform variant
```

### üìä D2 CLI Integration

**Problem**: D2 diagrams could not be rendered in Docker containers because D2 CLI was not available.

**Solution**: Added D2 CLI installation to Docker image for diagram rendering support.

**Features**:
- **D2 CLI included**: D2 CLI is now available in Docker containers
- **Automatic architecture detection**: D2 install script automatically detects architecture
- **Verified installation**: Installation is verified with version check

**Benefits**:
- ‚úÖ D2 diagrams can be rendered in Docker containers
- ‚úÖ `isD2Available()` function works correctly in Docker
- ‚úÖ No need for external D2 CLI installation
- ‚úÖ Automatic architecture detection

**Example**:
```bash
# D2 CLI is available in the container
docker exec -it <container-name> d2 --version
```

---

## Bug Fixes

### Docker Pull on AMD64 Servers

**Problem**: Pulling Docker images on AMD64 servers (e.g., Hetzner) failed with "no matching manifest for linux/amd64" error.

**Root Cause**: Docker images were only built for ARM64 architecture.

**Solution**: Added multi-platform support to build images for both ARM64 and AMD64.

**Benefits**:
- ‚úÖ Docker images now work on AMD64 servers
- ‚úÖ No more "no matching manifest" errors
- ‚úÖ Automatic platform selection
- ‚úÖ Better compatibility with hosting providers

---

## Migration Guide

### No Migration Required

This update is **backward compatible**. Existing installations will continue to work:

- ‚úÖ ARM64 servers continue to work (no changes)
- ‚úÖ AMD64 servers now work (previously failed)
- ‚úÖ Docker images automatically select correct platform
- ‚úÖ No configuration changes needed

### To Deploy on AMD64 Servers

**No changes needed** - simply pull the image:

```bash
docker pull ghcr.io/paideia-lms/paideia:latest
# or
docker pull <dockerhub-username>/paideia:latest
```

Docker will automatically select the AMD64 variant if you're on an AMD64 server.

### To Use D2 Diagrams in Docker

**No changes needed** - D2 CLI is now included in the Docker image:

```bash
# D2 CLI is available in the container
docker exec -it <container-name> d2 --version
```

The `isD2Available()` function will now return `true` in Docker containers.

---

## Breaking Changes

None. All changes are backward compatible.

---

## Dependencies

### New Dependencies in Docker Image

- **curl**: Added to runtime dependencies (for D2 CLI installation)
- **D2 CLI**: Installed via official installation script from `https://d2lang.com/install.sh`

---

## Testing

- ‚úÖ Docker images build for both ARM64 and AMD64
- ‚úÖ Docker images pull correctly on ARM64 servers
- ‚úÖ Docker images pull correctly on AMD64 servers
- ‚úÖ D2 CLI is available in Docker containers
- ‚úÖ `isD2Available()` returns `true` in Docker containers
- ‚úÖ D2 diagrams render correctly in Docker containers
- ‚úÖ Backward compatible with existing deployments

---

## Technical Details

### Multi-Platform Docker Build

**How It Works**:
1. **Buildx detects platform**: Automatically sets `TARGETARCH` based on build platform
2. **Binary selection**: Dockerfile copies the correct binary based on `TARGETARCH`:
   - `linux/arm64` ‚Üí `TARGETARCH=arm64` ‚Üí copies `dist/paideia-linux-arm64`
   - `linux/amd64` ‚Üí `TARGETARCH=amd64` ‚Üí copies `dist/paideia-linux-amd64`
3. **Multi-platform manifest**: Docker Buildx creates a manifest supporting both architectures
4. **Automatic selection**: When pulling, Docker automatically selects the correct platform variant

### D2 CLI Installation

**How It Works**:
1. **Install curl**: Required for downloading D2 install script
2. **Download and install**: Uses official D2 installation script from `https://d2lang.com/install.sh`
3. **Automatic detection**: Script automatically detects architecture and installs correct binary
4. **Verification**: Runs `d2 --version` to verify installation

---

## Thank You

Thank you for using Paideia LMS. This patch release adds multi-platform Docker support and D2 CLI integration, making it easier to deploy on a wider range of servers and enabling diagram rendering in Docker containers.

For questions, issues, or contributions, please visit our GitHub repository: https://github.com/paideia-lms/paideia

---

## Complete Changelog Reference

This release includes all changes from changelog 0035:

### Infrastructure & Docker Improvements (0035)
- **0035** - Multi-Platform Docker Support: Added support for both ARM64 and AMD64 architectures
- **0035** - D2 CLI Integration: Added D2 CLI installation to Docker image for diagram rendering

### Detailed Changelog

#### Multi-Platform Docker Support
- Updated Dockerfile to use `TARGETARCH` for platform-specific binary selection
- Updated GitHub Actions workflow to build and push multi-platform images
- Added support for both `linux/arm64` and `linux/amd64` platforms
- Automatic platform selection when pulling images
- Single image tag supports multiple architectures

#### D2 CLI Integration
- Added `curl` to runtime dependencies
- Installed D2 CLI using official installation script
- Automatic architecture detection by D2 install script
- Verified installation with version check
- D2 diagrams can now be rendered in Docker containers

---

**Full Changelog Details**: See changelog file `changelogs/0035-2025-11-03-multi-platform-docker-and-d2-cli.md` for detailed information about each feature and change.

