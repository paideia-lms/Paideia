# Release Notes - Paideia LMS v0.7.3

**Release Date:** November 28, 2025  
**Version:** 0.7.3  
**Type**: Feature Release & Infrastructure Improvements  
**Impact**: High - Course module settings v2 migration, logo/favicon upload, dashboard enhancements, and comprehensive code quality improvements  
**Changelog**: 0067, 0068, 0069, 0070, 0071, 0072, 0073, 0074

## Overview

Paideia LMS v0.7.3 introduces significant architectural improvements and new features that enhance both user experience and developer productivity. This release includes the migration to Course Module Settings v2, enabling per-course timing and attempt configuration, comprehensive logo and favicon upload functionality with theme-aware display, a visually striking dashboard clock with neon dark mode theme, and extensive infrastructure improvements including standardized internal function patterns, refactored upload handling, and test case monitoring. The release also includes an experimental file activity module feature (not production-ready) and improved error handling with internationalization support for better user experience.

---

## Major Features

### ‚öôÔ∏è Course Module Settings v2 and Timing Fields Migration

**New Feature**: Migration of timing and attempt-related fields from activity modules to course module settings, enabling per-course configuration for the same module.

**What's New**:
- **Course-Specific Timing**: Same activity module can have different due dates, attempt limits, and submission windows per course
- **Settings v2 Schema**: New versioned JSON schema for course module settings with enhanced type safety
- **Field Migration**: `dueDate`, `maxAttempts`, and `allowLateSubmissions` moved from assignments/quizzes to course settings
- **Automatic Migration**: Existing v1 settings automatically migrate to v2 when accessed
- **Enhanced Validation**: New `maxAttempts` validation (must be >= 1) and improved date validation

**User Experience**:
- **For Instructors**:
  - Configure timing and attempt limits per course, not per module
  - Reuse assignment/quiz templates with different timing across courses
  - Set course-specific due dates, opening/closing times, and attempt limits
  - Clear separation between reusable module templates and course-specific settings

**Key Changes**:
- Assignment and quiz modules no longer store timing fields directly
- Course module settings v2 includes `maxAttempts` for assignments and quizzes
- `allowLateSubmissions` removed (handled by `cutoffDate > dueDate` for assignments)
- Quiz closing times are strict deadlines (no late submissions)

**Technical Details**:
- Standalone v2 type definitions (no dependencies on v1)
- Automatic v1 ‚Üí v2 migration preserves all existing data
- Database migration removes columns from `assignments` and `quizzes` tables
- All timing fields now managed through course module settings

---

### üé® Logo and Favicon Upload

**New Feature**: Comprehensive logo and favicon upload functionality with theme-aware display for complete branding control.

**What's New**:
- **Theme-Aware Logos**: Upload separate logos for light and dark themes
- **Favicon Support**: Upload favicons for both themes (appears in browser tabs)
- **Compact Logos**: Support for compact logo variants (reserved for future use)
- **Media Usage Tracking**: Proper tracking prevents accidental deletion of logos in use
- **Clear Functionality**: Easy removal of logos and favicons

**User Experience**:
- **For Administrators**:
  - Upload logos via dedicated admin page (`Admin ‚Üí Appearance ‚Üí Logo`)
  - Visual preview of current logos in dropzones
  - Clear/remove functionality for each logo type
  - Upload size limits enforced from site policies
  - Clear instructions on logo usage and placement

- **For All Users**:
  - Custom logos displayed in application header
  - Theme-appropriate logos automatically shown based on user preference
  - Custom favicons in browser tabs and bookmarks
  - Professional branding throughout the application

**Logo Types**:
- **Logo**: Main logo displayed in header (light/dark variants)
- **Compact Logo**: Reserved for future use (light/dark variants)
- **Favicon**: Browser tab icon (light/dark variants)

**Technical Details**:
- 6 relationship fields added to `AppearanceSettings` global
- Logo media tracked in media usage system
- Transaction support for atomic logo uploads
- Automatic theme-based logo selection in header and favicon

---

### üïê Dashboard Clock with Neon Dark Mode Theme

**New Feature**: Real-time clock component on dashboard with automatic neon cyber theme in dark mode.

**What's New**:
- **Real-Time Clock**: Visual clock component displaying current time with smooth animations
- **Neon Dark Mode Theme**: Automatic neon cyber theme when user is in dark mode
- **Theme Detection**: Automatically switches themes based on user's color scheme preference
- **Smooth Animations**: Continuous second hand movement and pulsing glow effects
- **Responsive Layout**: Clock positioned alongside greeting text with proper spacing

**User Experience**:
- **For All Users**:
  - Visual time reference on dashboard
  - Enhanced dashboard visual appeal
  - Smooth animations provide modern feel
  - Automatic theme adaptation (no manual configuration)

**Visual Features**:
- **Light Mode**: Default clock styling with standard appearance
- **Dark Mode**: Neon cyber theme with:
  - Cyan glowing numbers (#00d4ff)
  - Orange hour hand gradient
  - Cyan minute hand gradient
  - Pink second hand with strong glow
  - Pulsing background animation
  - Radial gradient backgrounds

**Technical Details**:
- Uses `@gfazioli/mantine-clock` package
- CSS module for neon theme styles
- Automatic theme detection via `useMantineColorScheme` hook
- Clock size: 120px for optimal visibility

---

### üìÅ File Activity Module (Experimental)

**New Feature**: File-type activity module allowing instructors to upload and share multiple files with students.

**‚ö†Ô∏è Status**: This feature is **experimental and not production-ready**. It contains known bugs and should not be used in production environments.

**What's New**:
- **File Module Type**: New "file" activity module type alongside page, whiteboard, assignment, quiz, and discussion
- **Multiple File Upload**: Upload and organize multiple media files per module
- **File Preview**: Display files with type icons and download links
- **File Management**: Add/remove files from modules

**Current Limitations**:
- Transaction management edge cases may need refinement
- File upload flow may have issues with large files
- Media relationship tracking may not be fully implemented
- UI components may need additional polish
- Access control may need additional validation

**Technical Details**:
- New `Files` collection with media relationships
- File management internal functions
- File upload form component with drag-and-drop
- File preview component with type detection
- Database migrations for files tables

**Note**: This feature is included for development/testing purposes only. Do not use in production until bugs are fixed.

---

## Infrastructure Improvements

### üîí Custom Error Translations

**Enhancement**: Improved error handling with internationalization support.

**What's New**:
- **CustomForbidden Error**: New error class with translation support for internationalized error messages
- **Multi-Language Support**: Error messages in English, Japanese, Chinese Simplified, and Chinese Traditional
- **Contextual Errors**: Error messages include operation, user role, and resource information

**Benefits**:
- **For Users**: Clear, localized error messages in their preferred language
- **For Developers**: Consistent error handling pattern across collections
- **For Maintainability**: Easy to add new error messages and languages

**Technical Details**:
- `CustomForbidden` error class extends Payload's `APIError`
- Translation system supports template variables (operation, resource, userRole)
- Foundation for future access control error improvements

---

### üì§ Upload Handler Refactoring and Complexity Reduction

**Enhancement**: Centralized upload handling logic with significant code complexity reduction.

**What's New**:
- **Centralized Upload Handler**: Single utility module for all file upload handling
- **Pattern Matching**: Bun's native `Glob` class for flexible field name matching
- **Result-Based Error Handling**: Uses `typescript-result` for consistent error handling
- **Transaction Management**: Automatic commit/rollback handling
- **Base64 Image Replacement**: Extracted utility for HTML content image replacement

**Benefits**:
- **40% Code Reduction**: Reduced lines of code in route files
- **50% Complexity Reduction**: Lower cyclomatic complexity
- **DRY Principle**: Eliminated duplication across 10+ route files
- **Consistent Patterns**: All routes follow the same upload pattern

**Technical Details**:
- `createMediaUploadHandler`: Factory function for media creation
- `tryParseFormDataWithMediaUpload`: Result-based form parsing
- `replaceBase64ImagesWithMediaUrls`: HTML content image replacement
- `handleUploadError`: Centralized error handling
- Transaction helper functions for commit/rollback

---

### üîß Internal Function Pattern Standardization

**Enhancement**: Comprehensive standardization of internal function patterns across the codebase.

**What's New**:
- **Transaction Pattern**: `transactionInfo.tx` method replaces manual try-catch blocks
- **User Context Standardization**: User accessed via `req.user` instead of direct parameter
- **Interface Definitions**: All argument types use `interface` instead of `type`
- **Args Object Pattern**: Consistent function calling with args objects

**Benefits**:
- **Reduced Boilerplate**: Eliminated repetitive try-catch blocks across 19+ files
- **Automatic Transaction Handling**: Transactions always properly committed/rolled back
- **Consistent API**: All internal functions follow the same patterns
- **Better Type Safety**: Interfaces provide better type checking

**Standardized Patterns**:
- Transaction handling via `transactionInfo.tx`
- User context via `req.user`
- Interface definitions extending `BaseInternalFunctionArgs`
- Args object pattern for all function calls

**Files Refactored**: 19+ internal function files updated to new patterns

---

### üìä Test Case Monitoring and Stability Indicator

**Enhancement**: Systematic test case monitoring as a key stability metric.

**What's New**:
- **Test Log Processing**: Automated script for test log analysis and verification
- **False Alarm Detection**: Distinguishes between transient and persistent test failures
- **Stability Tracking**: Monitor test pass rates over time as stability indicator
- **Verification Summary**: Automatic categorization of test failures

**Current Status**:
- **442 total tests** across **40 test files**
- **97.3% pass rate** (430/442 passing as of November 28, 2025)
- Tests cover critical areas: activity modules, courses, enrollments, gradebooks, quizzes, permissions

**Benefits**:
- **Quantitative Stability**: Objective measurement of system stability
- **Early Regression Detection**: Identify issues before production
- **Release Readiness**: Use pass rate as gate for releases
- **Trend Analysis**: Track long-term stability trends

**Technical Details**:
- `scripts/process-test-log.ts`: Test log processing script
- Test logs stored in `tests/reports/` with date-based naming
- Automatic false alarm detection via test re-runs
- Verification summaries appended to log files

---

## Migration Guide

### Database Migration

This release includes a database migration that adds file activity module support, logo/favicon fields, and removes timing fields from assignments/quizzes.

**Migration Steps**:
1. Upgrade to v0.7.3
2. The migration will be automatically applied when you start the server, or you can manually run:
   ```bash
   bun run payload migrate
   ```
3. The migration will:
   - Add 'file' value to `enum_activity_modules_type`
   - Create `files` and `files_rels` tables
   - Add `file_id` column to `activity_modules` table
   - Add logo/favicon relationship columns to `appearance_settings` table
   - Remove `due_date`, `max_attempts`, and `allow_late_submissions` columns from `assignments` table
   - Remove `due_date`, `max_attempts`, and `allow_late_submissions` columns from `quizzes` table
   - Drop related indexes

**What the Migration Does**:
- Creates file activity module infrastructure
- Adds logo/favicon upload support
- Migrates timing fields from activity modules to course module settings
- All changes are backward compatible (existing course module settings automatically migrate to v2)

**After Migration**:
- ‚úÖ Server starts successfully
- ‚úÖ Existing course module settings automatically migrate to v2
- ‚úÖ Logo/favicon fields are `null` by default (can be uploaded via admin interface)
- ‚úÖ File activity modules can be created (experimental feature)
- ‚úÖ All new features are immediately available

**Important Notes**:
- **Data Loss**: Columns removed from `assignments` and `quizzes` tables. Data in these columns will be lost unless migrated to course module settings first.
- **Course Module Settings**: Existing v1 settings automatically migrate to v2 when accessed
- **File Modules**: Experimental feature - do not use in production
- **Logo Upload**: Logo fields are optional, so no required data migration

---

## Breaking Changes

### API Changes

**Activity Module Management**:
- `tryCreateAssignmentModule`: No longer accepts `dueDate`, `maxAttempts`, `allowLateSubmissions`
- `tryCreateQuizModule`: No longer accepts `dueDate`, `maxAttempts`, `allowLateSubmissions`
- `tryUpdateAssignmentModule`: No longer accepts `dueDate`, `maxAttempts`, `allowLateSubmissions`
- `tryUpdateQuizModule`: No longer accepts `dueDate`, `maxAttempts`, `allowLateSubmissions`

**Result Types**:
- `AssignmentModuleResult`: No longer includes `dueDate`, `maxAttempts`, `allowLateSubmissions`
- `QuizModuleResult`: No longer includes `dueDate`, `maxAttempts`, `allowLateSubmissions`

**Frontend Changes**:
- Assignment forms no longer include timing/attempt fields
- Quiz forms no longer include timing/attempt fields
- These fields should now be configured via course module settings (course-specific)

**Migration Path**:
- Timing and attempt configuration moved to course module settings
- User module edit forms no longer show these fields
- Course module edit forms should be used for timing configuration

---

## Dependencies

### New Dependencies

- **`@gfazioli/mantine-clock@2.1.8`**: Clock component for dashboard

### No Removed Dependencies

All existing dependencies remain unchanged.

---

## Testing

### Course Module Settings v2
- ‚úÖ Creating assignment/quiz modules without timing fields
- ‚úÖ Updating course module settings with v2 format
- ‚úÖ v1 to v2 automatic migration
- ‚úÖ `maxAttempts` validation (must be >= 1)
- ‚úÖ Date validation with `maxAttempts` present
- ‚úÖ FileSettings creation and retrieval

### Logo and Favicon Upload
- ‚úÖ Logo upload for all 6 logo types
- ‚úÖ Logo display in header (light and dark themes)
- ‚úÖ Favicon display in browser (light and dark themes)
- ‚úÖ Logo clearing functionality
- ‚úÖ Transaction rollback on errors
- ‚úÖ Media usage tracking for logos
- ‚úÖ File size and type validation
- ‚úÖ Theme-based logo selection

### Dashboard Clock
- ‚úÖ Clock displays correctly in light mode
- ‚úÖ Clock displays correctly in dark mode with neon theme
- ‚úÖ Theme switching updates clock styling automatically
- ‚úÖ Clock updates in real-time
- ‚úÖ Clock positioning and layout
- ‚úÖ Responsive layout maintains proper positioning

### Infrastructure Improvements
- ‚úÖ CustomForbidden throws correct error with 403 status
- ‚úÖ Error messages in all supported languages
- ‚úÖ Upload handler processes various field name patterns
- ‚úÖ Transaction rollback on upload errors
- ‚úÖ Base64 image replacement accuracy
- ‚úÖ Internal function patterns work correctly
- ‚úÖ Test log processing and verification

### File Activity Module (Experimental)
- ‚ö†Ô∏è File module creation (experimental - contains bugs)
- ‚ö†Ô∏è File upload functionality (experimental - contains bugs)
- ‚ö†Ô∏è File module updates (experimental - contains bugs)

---

## Upgrade Instructions

### From v0.7.2 or Earlier

1. **Check migration status** (optional):
   ```bash
   bun run payload migrate:status
   ```

2. **Upgrade to v0.7.3**:
   ```bash
   git pull origin next  # or your branch
   ```

3. **Install new dependencies**:
   ```bash
   bun install
   ```

4. **Start the server** (migration will be applied automatically):
   ```bash
   bun run dev
   ```
   
   Or manually apply the migration first:
   ```bash
   bun run payload migrate
   bun run dev
   ```

5. **Regenerate Payload types**:
   ```bash
   bun run payload generate:types
   ```

6. **Configure Logos** (optional):
   - Navigate to Admin ‚Üí Appearance ‚Üí Logo
   - Upload logos and favicons for light and dark themes
   - Logos will appear in header and favicons in browser tabs

7. **Explore New Features**:
   - Configure course-specific timing via course module settings
   - View dashboard clock with neon theme in dark mode
   - Test experimental file activity module (development only)

---

## What's Next

This release significantly enhances the architecture with Course Module Settings v2, comprehensive branding control, and extensive infrastructure improvements. Future releases will continue to build on these foundations with:

- File activity module bug fixes and production readiness
- Additional course module settings features
- Enhanced logo positioning and sizing options
- More languages for error translations
- Additional access control patterns for other collections
- Test case monitoring dashboard and trend visualization

---

## Thank You

Thank you for using Paideia LMS. This release brings important architectural improvements, enhanced branding capabilities, and comprehensive code quality enhancements that make the platform more flexible, maintainable, and user-friendly. The migration to Course Module Settings v2 enables greater flexibility for instructors reusing modules across courses, while the infrastructure improvements establish solid foundations for future development.

For questions, issues, or contributions, please visit our GitHub repository: https://github.com/paideia-lms/paideia

---

## Complete Changelog Reference

This release includes changes from changelogs 0067, 0068, 0069, 0070, 0071, 0072, 0073, and 0074:

### Dashboard Clock with Neon Dark Mode Theme (0067)
- **0067** - Real-Time Clock: Visual clock component on dashboard
- **0067** - Neon Dark Mode Theme: Automatic neon cyber theme in dark mode
- **0067** - Theme Detection: Automatic theme switching based on color scheme
- **0067** - Smooth Animations: Continuous second hand movement and pulsing effects

### Logo and Favicon Upload (0068)
- **0068** - Logo Upload: Theme-aware logo upload for light and dark themes
- **0068** - Favicon Support: Browser tab icon upload with theme support
- **0068** - Media Usage Tracking: Proper tracking prevents accidental deletion
- **0068** - Admin Interface: Dedicated admin page for logo management
- **0068** - Header Integration: Logos displayed in application header

### File Activity Module (0069)
- **0069** - File Module Type: New activity module type for file sharing
- **0069** - Multiple File Upload: Upload and organize multiple files per module
- **0069** - File Preview: Display files with type icons and download links
- **0069** - ‚ö†Ô∏è Experimental: Contains known bugs - not production-ready

### Custom Error Translations (0070)
- **0070** - CustomForbidden Error: Error class with translation support
- **0070** - Multi-Language Support: Error messages in 4 languages
- **0070** - Contextual Errors: Error messages include operation, role, and resource information
- **0070** - Translation System: Foundation for internationalized error messages

### Upload Handler Refactoring and Complexity Reduction (0071)
- **0071** - Centralized Upload Handler: Single utility for all upload handling
- **0071** - Pattern Matching: Glob-based field name matching
- **0071** - Result-Based Errors: Consistent error handling with typescript-result
- **0071** - Code Reduction: 40% reduction in lines of code, 50% complexity reduction

### Course Module Settings v2 and Timing Fields Migration (0072)
- **0072** - Settings v2 Schema: New versioned JSON schema for course settings
- **0072** - Field Migration: Timing fields moved from activity modules to course settings
- **0072** - Per-Course Configuration: Same module with different timing per course
- **0072** - Automatic Migration: v1 to v2 migration preserves all data
- **0072** - Enhanced Validation: New maxAttempts validation and improved date validation

### Internal Function Pattern Standardization (0073)
- **0073** - Transaction Pattern: transactionInfo.tx replaces manual try-catch
- **0073** - User Context: Standardized access via req.user
- **0073** - Interface Definitions: All argument types use interface
- **0073** - Args Object Pattern: Consistent function calling pattern

### Test Case Monitoring and Stability Indicator (0074)
- **0074** - Test Log Processing: Automated script for test analysis
- **0074** - False Alarm Detection: Distinguishes transient vs persistent failures
- **0074** - Stability Tracking: Monitor test pass rates as stability metric
- **0074** - Verification Summary: Automatic categorization of test failures

**Full Changelog Details**: See changelog files:
- `changelogs/0067-2025-11-20-dashboard-clock-with-neon-dark-mode-theme.md`
- `changelogs/0068-2025-11-21-logo-and-favicon-upload.md`
- `changelogs/0069-2025-11-21-file-activity-module.md`
- `changelogs/0070-2025-11-22-custom-error-translations-and-pattern-matching-access-control.md`
- `changelogs/0071-2025-11-22-upload-handler-refactoring-and-complexity-reduction.md`
- `changelogs/0072-2025-11-26-course-module-settings-v2-and-timing-fields-migration.md`
- `changelogs/0073-2025-11-27-internal-function-pattern-standardization.md`
- `changelogs/0074-2025-11-28-test-case-monitoring-and-stability-indicator.md`

**Previous Release**: See [v0.7.2 Release Notes](./0.7.2-2025-11-21.md) for previous features.

